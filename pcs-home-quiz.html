<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Sun Jan 18 2026 11:30:14 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="6968a3dd39333b922d770468" data-wf-site="69658389f59da527c04bcbd4" lang="en">
<head>
  <meta charset="utf-8">
  <title>PCS Home Quiz</title>
  <meta content="PCS Home Quiz" property="og:title">
  <meta content="https://cdn.prod.website-files.com/69658389f59da527c04bcbd4/69684b9318d216f9e8b5a184_IVy.jpg" property="og:image">
  <meta content="PCS Home Quiz" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/pcs-united.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <div class="w-embed w-script"><!--  =========================================================
  RealtySaSS • Frosted Glass Login Lock (PCS United)
  - Uses /api/login (Supabase Auth check)
  - After success:
      • Unlocks page
      • Stores login email/profile in localStorage for dashboards
  ✅ UPDATE (Aesthetics ONLY):
      • Background shows AIOU Quiz behind overlay (frosted)
      • Overlay is now translucent glass instead of dark curtain
      • Forces #aiou-portal behind overlay (no changes to AIOU code)
=========================================================  -->
    <div id="rs-lock-root" style="all: initial;">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
      <style>
    /* =========================================================
       //#1 SCOPE RESET
    ========================================================= */
    #rs-lock-root, #rs-lock-root *{
      box-sizing: border-box;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    /* =========================================================
       //#2 TOKENS (House of SaSS / RealtySaSS vibe)
    ========================================================= */
    #rs-lock-root{
      --bg:#0b0e1a;
      --panel:#101426;
      --panel2:#0f1324;
      --ink:#e9ecff;
      --muted:#a8b0d6;
      --border:rgba(255,255,255,.12);
      --border2:rgba(255,255,255,.18);
      --mint:#8ef3c5;
      --sapphire:#6aa7ff;
      --danger:#ff8aa6;
      --shadow: 0 24px 60px rgba(0,0,0,.75);
    }
    /* =========================================================
       //#2.5 IMPORTANT: Keep the AIOU quiz visible BEHIND the lock
       (no changes to AIOU code — we just place it under this overlay)
    ========================================================= */
    #aiou-portal{
      z-index: 2147483000 !important; /* below overlay, above normal page */
    }
    /* =========================================================
       //#3 OVERLAY (NOW TRANSLUCENT so AIOU shows through)
    ========================================================= */
    #rs-lock-overlay{
      position: fixed;
      inset: 0;
      z-index: 2147483647; /* must be above AIOU portal */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      /* ✅ KEY CHANGE: transparent glass veil (not a dark curtain) */
      background:
        radial-gradient(1100px 720px at 50% 38%, rgba(106,167,255,.12) 0%, rgba(0,0,0,0) 60%),
        radial-gradient(950px 620px at 28% 22%, rgba(142,243,197,.10) 0%, rgba(0,0,0,0) 58%),
        radial-gradient(1200px 900px at 50% 70%, rgba(0,0,0,.28) 0%, rgba(0,0,0,.55) 72%),
        rgba(11,14,26,.22);
      /* ✅ Frost effect that blurs whatever is behind (AIOU quiz) */
      -webkit-backdrop-filter: blur(16px) saturate(150%);
      backdrop-filter: blur(16px) saturate(150%);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity .22s ease, visibility .22s ease;
    }
    #rs-lock-overlay[aria-hidden="false"]{
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
    /* =========================================================
       //#4 CENTER WRAP
    ========================================================= */
    .rs-lock-centered{
      width: 100%;
      max-width: 520px;
    }
    /* =========================================================
       //#5 CARD (frosted glass)
    ========================================================= */
    .rs-lock-card{
      position: relative;
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow: hidden;
      background:
        radial-gradient(900px 600px at 10% 0%, rgba(255,255,255,.10) 0%, rgba(255,255,255,.02) 55%, rgba(0,0,0,0) 75%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      background-color: rgba(16,20,38,.55);
      -webkit-backdrop-filter: blur(22px) saturate(160%);
      backdrop-filter: blur(22px) saturate(160%);
      padding: 28px 26px 22px;
    }
    .rs-lock-card:before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: 20px;
      padding:2px;
      background: linear-gradient(135deg, rgba(142,243,197,.35), rgba(106,167,255,.25), rgba(255,255,255,0));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity:.55;
    }
    /* =========================================================
       //#6 TYPOGRAPHY
    ========================================================= */
    #rs-lock-title{
      margin: 0 0 6px;
      color: var(--ink);
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .16em;
      text-transform: uppercase;
      text-align: center;
    }
    .rs-lock-sub{
      margin: 0 0 18px;
      color: rgba(168,176,214,.88);
      font-size: 12.5px;
      line-height: 1.45;
      text-align: center;
    }
    /* =========================================================
       //#7 FIELDS
    ========================================================= */
    .rs-field{ margin: 10px 0; }
    #rs-email-input,
    #rs-pass-input{
      width: 100%;
      padding: 14px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      font-size: 14px;
      outline: none;
      box-shadow: 0 18px 36px rgba(0,0,0,.55) inset;
      transition: border-color .18s ease, box-shadow .18s ease, transform .18s ease;
    }
    #rs-email-input::placeholder,
    #rs-pass-input::placeholder{
      color: rgba(233,236,255,.40);
    }
    #rs-email-input:focus,
    #rs-pass-input:focus{
      border-color: rgba(106,167,255,.55);
      box-shadow:
        0 18px 36px rgba(0,0,0,.55) inset,
        0 0 0 3px rgba(106,167,255,.16);
      transform: translateY(-1px);
    }
    /* =========================================================
       //#8 BUTTONS
    ========================================================= */
    .rs-lock-actions{
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #rs-login-btn{
      width: 100%;
      padding: 14px 14px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      font-size: 14px;
      letter-spacing: .02em;
      color: #06112b;
      background: linear-gradient(180deg, rgba(142,243,197,1), rgba(106,167,255,.95));
      box-shadow: 0 18px 34px rgba(0,0,0,.65);
      transition: transform .15s ease, filter .15s ease, box-shadow .15s ease;
    }
    #rs-login-btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.02);
      box-shadow: 0 22px 44px rgba(0,0,0,.72);
    }
    #rs-login-btn:active{
      transform: translateY(0px);
      filter: brightness(.98);
    }
    #rs-login-btn[disabled]{
      opacity: .65;
      cursor: not-allowed;
      transform: none;
    }
    .rs-lock-foot{
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      text-align: center;
      color: rgba(168,176,214,.85);
      font-size: 12px;
    }
    #rs-signup-btn{
      display: inline-block;
      margin-top: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid rgba(142,243,197,.38);
      color: var(--mint);
      background: rgba(0,0,0,.10);
      font-weight: 800;
      font-size: 12px;
      cursor: pointer;
      text-decoration: none;
      transition: background .15s ease, transform .15s ease, border-color .15s ease;
    }
    #rs-signup-btn:hover{
      transform: translateY(-1px);
      background: rgba(142,243,197,.08);
      border-color: rgba(142,243,197,.55);
    }
    /* =========================================================
       //#9 ERROR TEXT
    ========================================================= */
    #rs-lock-error{
      margin-top: 10px;
      font-size: 12px;
      color: var(--danger);
      text-align: center;
      min-height: 16px;
    }
  </style>
      <!--  Keep your existing overlay structure / IDs  -->
      <div id="rs-lock-overlay" aria-hidden="true">
        <div class="rs-lock-centered" role="dialog" aria-labelledby="rs-lock-title" aria-modal="true">
          <div class="rs-lock-card" id="rs-lock-card">
            <h1 id="rs-lock-title">Sign In to Continue</h1>
            <p class="rs-lock-sub">This page is private — please enter your credentials.</p>
            <div class="rs-field">
              <input id="rs-email-input" type="email" placeholder="Email Address" autocomplete="email">
            </div>
            <div class="rs-field">
              <input id="rs-pass-input" type="password" placeholder="Password" autocomplete="current-password">
            </div>
            <div class="rs-lock-actions">
              <button id="rs-login-btn" type="button">Log In</button>
            </div>
            <div id="rs-lock-error"></div>
            <div class="rs-lock-foot">
              Not a Prime Member yet?
              <br>
              <a id="rs-signup-btn" href="/create-account" aria-label="Sign up">Sign Up</a>
            </div>
          </div>
        </div>
      </div>
      <script>
    (function(){
      "use strict";
      // ============================================================
      // //#10 CONFIG (logic unchanged)
      // ============================================================
      const API_BASE = "https://theorozcorealty.netlify.app/api";
      const LOGIN_ENDPOINT = API_BASE + "/login";
      const KEY_EMAIL = "realtysass.loginEmail";
      const overlay = document.getElementById("rs-lock-overlay");
      const emailEl = document.getElementById("rs-email-input");
      const passEl  = document.getElementById("rs-pass-input");
      const btnEl   = document.getElementById("rs-login-btn");
      const errEl   = document.getElementById("rs-lock-error");
      if(!overlay || !emailEl || !passEl || !btnEl) return;
      function show(){
        overlay.setAttribute("aria-hidden","false");
        // prevent scroll behind overlay
        try { document.documentElement.style.overflow = "hidden"; } catch(_){}
        try { document.body.style.overflow = "hidden"; } catch(_){}
      }
      function hide(){
        overlay.setAttribute("aria-hidden","true");
        try { document.documentElement.style.overflow = ""; } catch(_){}
        try { document.body.style.overflow = ""; } catch(_){}
      }
      function setError(msg){
        if(errEl) errEl.textContent = msg || "";
      }
      // Prefill email if stored
      try{
        const savedEmail = localStorage.getItem(KEY_EMAIL);
        if(savedEmail && !emailEl.value) emailEl.value = savedEmail;
      }catch(_){}
      // Always show on load (same gated behavior)
      show();
      async function doLogin(){
        setError("");
        const email = (emailEl.value || "").trim();
        const password = (passEl.value || "").trim();
        if(!email || !password){
          setError("Please enter your email and password.");
          return;
        }
        btnEl.disabled = true;
        btnEl.textContent = "Logging in…";
        try{
          const r = await fetch(LOGIN_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
          });
          const data = await r.json().catch(()=> ({}));
          if(!r.ok || !data || data.ok !== true){
            const msg = (data && (data.error || data.message)) ? (data.error || data.message) : ("Login failed (" + r.status + ")");
            throw new Error(msg);
          }
          // store email for downstream dashboards
          try{ localStorage.setItem(KEY_EMAIL, email); }catch(_){}
          // store profile if returned (non-breaking)
          if(data.profile){
            try{ localStorage.setItem("realtysass.profile.v1", JSON.stringify(data.profile)); }catch(_){}
          }
          // unlock
          hide();
          // broadcast (safe; helps other embeds wait if they want)
          try{ window.dispatchEvent(new CustomEvent("realtysass:unlocked", { detail: { email } })); }catch(_){}
        }catch(e){
          setError(e.message || "Login failed.");
        }finally{
          btnEl.disabled = false;
          btnEl.textContent = "Log In";
        }
      }
      btnEl.addEventListener("click", doLogin);
      passEl.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doLogin(); });
      emailEl.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doLogin(); });
    })();
  </script>
    </div>
  </div>
  <section>
    <div class="code-embed-12 w-embed w-script"><!--  //#0 A.I.O.U • Timed Buyer Psychology Test (Full-Screen Wide Layout v3 - auto report + Financial Dashboard Prefill)
     ✅ UPDATED: waits for login BEFORE mounting overlay (no more bypass)
     ✅ UPDATED: AIOU portal z-index lowered so Login overlay always wins
     ✅ UPDATE: now calls aiou-score.js (server-side scoring) + passes AIOU House Intake into aiou-report
     ✅ CONNECTION FIX (Requested):
        - Prefill "Profile & Goals" using AIOU House Intake:
          * Bedrooms wanted ← aiou_house_intake.bedrooms (or bridge.house.bedrooms)
          * Visual slider seed ← aiou_house_intake.styleVsPriceSlider (or bridge._aiouStyleVsPriceSlider)
     ✅ Nothing else changed (layout, UX, timing, UI all preserved)
 -->
      <div id="aiou-shell" data-endpoint="https://theorozcorealty.netlify.app/.netlify/functions/aiou-report" data-score-endpoint="https://theorozcorealty.netlify.app/.netlify/functions/aiou-score" style="all: initial;">
        <!--  Google Font  -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
        <style>
    /* =========================================================
       //#1 GLOBAL TOKENS / RESET
       ========================================================= */
    #aiou-shell,
    #aiou-shell * {
      box-sizing: border-box;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    :root {
      --bg:#0b0e1a;
      --panel:#101426;
      --panel-2:#0f1324;
      --ink:#e9ecff;
      --muted:#a8b0d6;
      --border:rgba(255,255,255,.10);
      --accent:#8ef3c5;
      --accent2:#6aa7ff;
      --danger:#ff8aa6;
      --chip-bg-start:#6aa7ff;
      --chip-bg-end:#4f86ff;
    }
    /* Full-screen fixed overlay */
    #aiou-portal {
      position: fixed;
      inset: 0;
      /* ✅ MUST be below login overlay z-index 2147483647 */
      z-index: 2147483000;
      background: var(--bg);
      color: var(--ink);
      overflow-y: auto;
      isolation: isolate;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 24px 0 80px;
    }
    /* =========================================================
       //#2 LAYOUT GRID
       ========================================================= */
    .aiou-wrap {
      width: 100%;
      max-width: 1400px;
      min-width: 1024px;
      margin: 0 auto;
      padding: 0 24px;
      display: grid;
      grid-template-columns: minmax(360px,1fr) minmax(360px,1fr);
      grid-auto-rows: min-content;
      gap: 24px;
    }
    @media(max-width:1100px){
      .aiou-wrap {
        min-width: 0;
        max-width: 100%;
        grid-template-columns: 1fr;
      }
    }
    /* =========================================================
       //#3 CARD STYLE
       ========================================================= */
    .aiou-card {
      background:
        radial-gradient(circle at 0% 0%, rgba(255,255,255,.07) 0%, rgba(0,0,0,0) 60%),
        linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.015) 60%,rgba(0,0,0,0) 100%);
      background-color: #101426;
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: 0 24px 48px rgba(0,0,0,.8);
      color: var(--ink);
      position: relative;
      padding: 20px 20px 16px;
    }
    /* timer HUD */
    .overallTimer {
      position: absolute !important;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      text-align: right;
    }
    .overallTimer .hint {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.3;
    }
    .overallTimer .badge {
      font-size: 11px;
      font-weight: 900;
      line-height: 1.2;
      padding: 5px 8px 4px;
      border-radius: 999px;
      background: linear-gradient(180deg,var(--chip-bg-start),var(--chip-bg-end));
      color: #06112b;
      border: none;
      min-width: 44px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0,0,0,.8);
    }
    .aiou-title-block h1 {
      margin: 0 0 12px;
      font-size: 22px;
      font-weight: 900;
      line-height: 1.25;
      letter-spacing: .2px;
      color: var(--ink);
      padding-right: 110px;
      text-transform: uppercase;
    }
    @media(max-width:600px){
      .aiou-title-block h1{
        font-size:20px;
        padding-right:0;
      }
    }
    .aiou-desc {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      margin: 0 0 12px;
      max-width: 480px;
    }
    .aiou-bar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .aiou-btn {
      border: 1px solid rgba(255,255,255,.14);
      background: var(--panel-2);
      color: var(--ink);
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 800;
      font-size: 13px;
      line-height: 1.2;
    }
    .aiou-btn.primary {
      background: linear-gradient(180deg,var(--chip-bg-start),var(--chip-bg-end));
      border: none;
      color: #06112b;
      box-shadow: 0 16px 32px rgba(0,0,0,.8);
    }
    .aiou-btn.warn {
      background: transparent;
      border-color: var(--danger);
      color: var(--danger);
    }
    /* =========================================================
       //#4 PROFILE CARD
       ========================================================= */
    .aiou-card h2 {
      margin: 0 0 6px;
      font-size: 14px;
      font-weight: 800;
      line-height: 1.3;
      letter-spacing: .2px;
      color: var(--ink);
      text-transform: uppercase;
    }
    .aiou-card .blurb {
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
      margin: 0 0 16px;
      max-width: 520px;
    }
    .aiou-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media(max-width:600px){
      .aiou-grid { grid-template-columns: 1fr; }
    }
    label.aiou-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--ink);
      display: block;
      margin-bottom: 6px;
      line-height: 1.3;
    }
    .aiou-input,
    .aiou-select {
      width: 100%;
      appearance: none;
      padding: 10px 12px;
      font-size: 13px;
      line-height: 1.3;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      box-shadow: 0 16px 32px rgba(0,0,0,.6) inset;
    }
    .aiou-input::placeholder {
      color: #c9d2ff88;
    }
    /* =========================================================
       //#5 FULL-WIDTH ROW CARDS
       ========================================================= */
    .aiou-card.fullrow {
      grid-column: 1 / -1;
    }
    /* question timer bar */
    .qtopbar {
      position: absolute;
      left: 16px;
      right: 16px;
      top: 10px;
      height: 6px;
      background: rgba(255,255,255,.10);
      border-radius: 999px;
      overflow: hidden;
    }
    .qtopbar > i {
      display: block;
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg,var(--accent),var(--accent2));
      transform-origin: left;
    }
    #qTitle {
      margin: 24px 0 4px;
      font-size: 15px;
      font-weight: 800;
      color: var(--ink);
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    #qText {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      margin: 0 0 12px;
      max-width: 600px;
    }
    /* visual question block */
    .dualpref {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 12px;
      align-items: center;
      margin-top: 10px;
    }
    @media(max-width:800px){
      .dualpref { grid-template-columns: 1fr; }
    }
    .dualpref figure { margin: 0; }
    .dualpref img {
      width: 100%;
      max-height: 280px;
      border-radius: 12px;
      border: 1px solid var(--border);
      object-fit: cover;
      object-position: center;
      background: #0b0e1a;
      box-shadow: 0 24px 48px rgba(0,0,0,.8);
      cursor: pointer;
    }
    .dualpref figcaption {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      margin-top: 6px;
    }
    .sliderRow {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .sliderRow .end {
      flex: 0 0 auto;
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
    }
    .rangeWrap {
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    input[type=range] {
      -webkit-appearance:none;
      appearance:none;
      width: 100%;
      height: 4px;
      background: rgba(255,255,255,.18);
      border-radius: 999px;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance:none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent2);
      border: 0;
      box-shadow: 0 8px 16px rgba(0,0,0,.8);
      cursor: pointer;
    }
    input[type=range]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--accent2);
      border: 0;
      box-shadow: 0 8px 16px rgba(0,0,0,.8);
      cursor: pointer;
    }
    input[type=range]::-webkit-slider-runnable-track {
      height: 4px;
      border-radius: 999px;
    }
    /* normal question scale */
    .scale {
      display: grid;
      grid-template-columns: repeat(11,1fr);
      gap: 8px;
      margin: 16px 0 0;
      max-width: 600px;
    }
    .pill {
      text-align: center;
      padding: 10px 0;
      border-radius: 10px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      cursor: pointer;
      line-height: 1.3;
      box-shadow: 0 16px 32px rgba(0,0,0,.6) inset;
      color: var(--ink);
    }
    .pill[data-sel="1"] {
      outline: 2px solid var(--accent2);
      color: #06112b;
      background: linear-gradient(180deg,var(--chip-bg-start),var(--chip-bg-end));
      border: none;
      box-shadow: 0 16px 32px rgba(0,0,0,.8);
    }
    .quiz-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    .quiz-hint {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      margin-top: 6px;
      max-width: 520px;
    }
    /* =========================================================
       //#6 RESULTS CARD
       ========================================================= */
    .kpi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 16px 0 12px;
    }
    .kpi-chip {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 12px;
      min-width: 140px;
      box-shadow: 0 24px 48px rgba(0,0,0,.8);
    }
    .kpi-chip h3 {
      margin: 0 0 6px;
      font-size: 11px;
      line-height: 1.3;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .2px;
    }
    .kpi-chip div {
      font-size: 18px;
      font-weight: 900;
      color: var(--ink);
      line-height: 1.2;
    }
    .consistency-block,
    .arch-block,
    .mbti-block {
      font-size: 12px;
      line-height: 1.5;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .arch-block,
    .mbti-block {
      color: var(--ink);
      font-weight: 800;
    }
    .flag {
      color: var(--danger);
      font-weight: 800;
    }
    .ok {
      color: #58f7b7;
      font-weight: 800;
    }
    #jsonReportBox {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.5;
      color: var(--ink);
      padding: 16px;
      min-height: 200px;
      box-shadow:
        0 24px 48px rgba(0,0,0,.8) inset,
        0 24px 48px rgba(0,0,0,.8);
      white-space: normal;
    }
    .results-actions { display: none; }
    /* =========================================================
       //#7 UTILITY
       ========================================================= */
    .hidden {
      display: none !important;
    }
  </style>
        <script>
    (function(){
      "use strict";
      /* =========================================================
         //#0.5 LOGIN GATE (NEW)
         - AIOU will not mount until user is logged in
         - Accepts either:
           (1) localStorage "realtysass.loginEmail"
           (2) window.RS_AUTH.ok === true
           (3) event "realtysass:unlocked"
      ========================================================= */
      const LOGIN_KEY = "realtysass.loginEmail";
      function hasLogin(){
        try{
          const ls = (localStorage.getItem(LOGIN_KEY) || "").trim();
          if (ls) return true;
        }catch(_){}
        try{
          if (window.RS_AUTH && window.RS_AUTH.ok === true) return true;
        }catch(_){}
        return false;
      }
      function waitForLoginThenMount(mountFn){
        if (hasLogin()) return mountFn();
        const onUnlock = () => {
          if (hasLogin()){
            cleanup();
            mountFn();
          }
        };
        const poll = setInterval(() => {
          if (hasLogin()){
            cleanup();
            mountFn();
          }
        }, 200);
        function cleanup(){
          clearInterval(poll);
          try{ window.removeEventListener("realtysass:unlocked", onUnlock); }catch(_){}
        }
        try{ window.addEventListener("realtysass:unlocked", onUnlock); }catch(_){}
      }
      // ============================================================
      // //#8 MOUNT AIOU (ONLY AFTER LOGIN)
      // ============================================================
      waitForLoginThenMount(function mountAIOU(){
        if (window.__AIOU_MOUNTED__) return;
        window.__AIOU_MOUNTED__ = true;
        /* =========================================================
           //#8 CREATE OVERLAY PORTAL
           ========================================================= */
        const portal = document.createElement('div');
        portal.id = 'aiou-portal';
        document.body.appendChild(portal);
        /* =========================================================
           //#9 DOM STRUCTURE (2-col row, then full-width rows)
           ========================================================= */
        portal.innerHTML = `
          <div class="aiou-wrap">
            <!-- //#9.1 INTRO / TIMER CARD -->
            <div class="aiou-card" id="introCard">
              <div class="overallTimer">
                <span class="hint">About <span id="overallHint">~3 min</span></span>
                <span class="badge" id="overallClock">3:00</span>
              </div>
              <div class="aiou-title-block">
                <h1>A.I.O.U • TIMED<br>BUYER<br>PSYCHOLOGY TEST</h1>
                <p class="aiou-desc">
                  Each question is timed (<b>10 seconds</b>). Choose from
                  <b>-5</b> to <b>+5</b>.
                  Some items repeat in different words to check consistency.
                </p>
              </div>
              <div class="aiou-bar">
                <button class="aiou-btn primary" id="startQuiz">Start Timed Quiz</button>
                <button class="aiou-btn" id="closePortal">Close</button>
              </div>
            </div>
            <!-- //#9.2 PROFILE CARD -->
            <div class="aiou-card" id="profileCard">
              <h2>Profile & Goals</h2>
              <p class="blurb">
                We use this context to generate your personalized Buyer Memo at the end.
                (Auto-filled from your Financial Dashboard when possible.)
              </p>
              <div class="aiou-grid">
                <div>
                  <label class="aiou-label">First Name</label>
                  <input id="firstName" class="aiou-input" type="text" placeholder="e.g., Alex">
                </div>
                <div>
                  <label class="aiou-label">Last Name</label>
                  <input id="lastName" class="aiou-input" type="text" placeholder="e.g., Rivera">
                </div>
                <div>
                  <label class="aiou-label">Bedrooms wanted</label>
                  <input id="bedrooms" class="aiou-input" type="number" min="0" step="1" placeholder="e.g., 4">
                </div>
                <div>
                  <label class="aiou-label">Budget (max $)</label>
                  <input id="budget" class="aiou-input" type="number" min="0" step="1000" placeholder="e.g., 450000">
                </div>
                <div>
                  <label class="aiou-label">Preferred setting</label>
                  <select id="setting" class="aiou-select">
                    <option value="city">City</option>
                    <option value="suburb">Suburb</option>
                    <option value="rural">Rural</option>
                  </select>
                </div>
                <div>
                  <label class="aiou-label">Safety priority (1–5)</label>
                  <select id="safety" class="aiou-select">
                    <option>1</option><option>2</option><option>3</option>
                    <option>4</option><option selected>5</option>
                  </select>
                </div>
              </div>
            </div>
            <!-- //#9.3 QUIZ CARD -->
            <div class="aiou-card fullrow hidden" id="quizCard" style="position:relative;">
              <div class="qtopbar"><i id="qTopTimer"></i></div>
              <div id="qTitle">Question</div>
              <div id="qText" class="aiou-desc" style="margin-bottom:12px;"></div>
              <!-- visual question -->
              <div id="visualArea" class="hidden">
                <div class="dualpref">
                  <figure>
                    <img id="vImgA"
                      src="https://cdn.prod.website-files.com/68cecb820ec3dbdca3ef9099/68f9a10aab47946a36f5c135_04d878cc02583fb9bfda33ddbd28d91a_MinorFixesHome.jpg"
                      alt="May Require Fixes (Option A)">
                    <figcaption>May Require Fixes</figcaption>
                  </figure>
                  <figure>
                    <img id="vImgB"
                      src="https://cdn.prod.website-files.com/68cecb820ec3dbdca3ef9099/68f9a113c4924ecebad2319a_a0cc3184b96f525ed5a278c3bac62891_BrandNewHome.jpg"
                      alt="Brand New Home (Option B)">
                    <figcaption>Brand New Home</figcaption>
                  </figure>
                  <div class="sliderRow">
                    <span class="end">Needs Fixes</span>
                    <div class="rangeWrap">
                      <input id="vSlider" type="range" min="-5" max="5" value="0" step="1"
                        aria-label="Preference between Needs Fixes and Brand New">
                    </div>
                    <span class="end">Brand New</span>
                  </div>
                </div>
                <div class="aiou-desc" id="vLabel" style="text-align:center;margin-top:8px;">Neutral</div>
              </div>
              <!-- standard scale -->
              <div class="scale" id="scaleBlock"></div>
              <div class="quiz-controls">
                <button class="aiou-btn" id="skip">Skip</button>
                <button class="aiou-btn warn" id="reset">Reset</button>
              </div>
              <div class="quiz-hint">
                No answer = neutral (0) after 10 seconds. “Skip” moves on immediately.
              </div>
            </div>
            <!-- //#9.4 RESULTS CARD -->
            <div class="aiou-card fullrow hidden" id="resultsCard">
              <h2>Results</h2>
              <p class="blurb">
                Your buyer psychology profile and personalized memo.
              </p>
              <div class="kpi-row">
                <div class="kpi-chip">
                  <h3>OPENNESS</h3>
                  <div id="kO">—</div>
                </div>
                <div class="kpi-chip">
                  <h3>CONSCIENTIOUSNESS</h3>
                  <div id="kC">—</div>
                </div>
                <div class="kpi-chip">
                  <h3>EXTRAVERSION</h3>
                  <div id="kE">—</div>
                </div>
                <div class="kpi-chip">
                  <h3>AGREEABLENESS</h3>
                  <div id="kA">—</div>
                </div>
                <div class="kpi-chip">
                  <h3>RISK AVERSION</h3>
                  <div id="kN">—</div>
                </div>
              </div>
              <div id="consistency" class="consistency-block"></div>
              <div id="archetype" class="arch-block" style="font-weight:900;"></div>
              <div id="mbti" class="mbti-block"></div>
              <div id="jsonReportBox">(Generating your personalized memo…)</div>
              <div class="results-actions">
                <button class="aiou-btn primary" id="btnReport">Generate Report (OpenAI)</button>
              </div>
            </div>
          </div>
        `;
        /* =========================================================
           //#9.5  PREFILL FROM FINANCIAL DASHBOARD
           ========================================================= */
        function prefillFromFinancial(){
          const rsRoot = document.querySelector('#rs-shell');
          function readField(sel){
            if(!rsRoot) return '';
            const el = rsRoot.querySelector(sel);
            if(!el) return '';
            if('value' in el && el.value !== undefined && el.value !== null && String(el.value).trim() !== ''){
              return String(el.value).trim();
            }
            if('textContent' in el && el.textContent){
              return String(el.textContent).trim();
            }
            return '';
          }
          const first = readField('.pf-fname');
          const last  = readField('.pf-lname');
          const price = readField('#h-price'); // treat as "budget max"
          const aiouFirst = portal.querySelector('#firstName');
          const aiouLast  = portal.querySelector('#lastName');
          const aiouBudget= portal.querySelector('#budget');
          if (aiouFirst && first && !aiouFirst.value) { aiouFirst.value = first; }
          if (aiouLast  && last  && !aiouLast.value ) { aiouLast.value  = last;  }
          if (aiouBudget&& price && !aiouBudget.value){
            aiouBudget.value = price;
          }
        }
        /* =========================================================
           //#9.6 PREFILL FROM AIOU HOUSE INTAKE (CONNECTION FIX)
           ========================================================= */
        const AIOU_HOUSE_KEY = "realtysass.aiou_house_intake.v1";
        const BRIDGE_KEY     = "realtysass.bridge";
        function readJSON(key, fallback){
          try { return JSON.parse(localStorage.getItem(key) || "null") ?? fallback; }
          catch(_) { return fallback; }
        }
        function prefillFromAIOUHouse(){
          const aiouHouse = readJSON(AIOU_HOUSE_KEY, {}) || {};
          const bridge = readJSON(BRIDGE_KEY, {}) || {};
          const bridgeHouse = (bridge && bridge.house) ? bridge.house : {};
          const bedsFromIntake =
            (aiouHouse.bedrooms ?? bridgeHouse.bedrooms ?? null);
          const sliderFromIntake =
            (aiouHouse.styleVsPriceSlider ?? bridge._aiouStyleVsPriceSlider ?? null);
          const elBeds = portal.querySelector('#bedrooms');
          if (elBeds && (elBeds.value == null || String(elBeds.value).trim() === '')){
            if (bedsFromIntake != null && Number(bedsFromIntake) > 0){
              elBeds.value = String(Math.round(Number(bedsFromIntake)));
            }
          }
          if (sliderFromIntake != null && Number.isFinite(Number(sliderFromIntake))){
            window.__STYLE_V_PRICE = Math.max(-5, Math.min(5, Number(sliderFromIntake)));
          }
        }
        prefillFromFinancial();
        prefillFromAIOUHouse();
        /* =========================================================
           //#10 SHORTCUTS
           ========================================================= */
        const $  = (sel)=>portal.querySelector(sel);
        const $$ = (sel)=>Array.from(portal.querySelectorAll(sel));
        /* =========================================================
           //#11 QUESTIONS
           ========================================================= */
        const Q = [
          { id:'V1', type:'visual', dim:'O',
            text:'Choose between Brand New Home vs May Require Fixes.', rev:false },
          { id:'O1',  dim:'O', text:'I prefer a home that looks new or freshly renovated rather than plain but practical.', rev:false, ctrlPair:'O1b' },
          { id:'O1b', dim:'O', text:'I’m fine with a simple, ordinary-looking home if it works.',                         rev:true,  ctrlPair:'O1'  },
          { id:'O2',  dim:'O', text:'Special features (big windows, open kitchen, modern finishes) are worth paying more.', rev:false },
          { id:'O3',  dim:'O', text:'I want a home that feels different from most homes I’ve seen.',                      rev:false },
          { id:'C1',  dim:'C', text:'If a place is just above my budget, I would still try to get it.', rev:true,  ctrlPair:'C1b' },
          { id:'C1b', dim:'C', text:'I will not go over my budget, even if I love the home.',          rev:false, ctrlPair:'C1'  },
          { id:'C2',  dim:'C', text:'Lower monthly costs matter more to me than extra style.',          rev:false },
          { id:'E1',  dim:'E', text:'I often picture hosting dinners, parties, or family gatherings at home.', rev:false, ctrlPair:'E1b' },
          { id:'E1b', dim:'E', text:'I rarely imagine hosting people at my home.',                             rev:true,  ctrlPair:'E1'  },
          { id:'E2',  dim:'E', text:'I would trade an extra bedroom for a bigger living room or outdoor area.', rev:false },
          { id:'A1',  dim:'A', text:'I can be flexible on details if the main things are met.', rev:false, ctrlPair:'A1b' },
          { id:'A1b', dim:'A', text:'Once I set my must-haves, I won’t bend on them.',          rev:true,  ctrlPair:'A1'  },
          { id:'N1',  dim:'N', text:'Buying a home that needs repairs would stress me out.',         rev:false, ctrlPair:'N1b' },
          { id:'N1b', dim:'N', text:'A home that needs repairs doesn’t worry me much.',              rev:true,  ctrlPair:'N1'  },
          { id:'N2',  dim:'N', text:'I’d rather choose a 5–10 year-old home that’s already proven than brand-new.', rev:false },
          { id:'N3',  dim:'N', text:'I prefer a quieter, safer area even if it’s farther from restaurants and events.', rev:false },
          { id:'X1',  dim:'O', text:'If I must choose, I’ll pick style and layout over getting the lowest possible price.', rev:false }
        ];
        /* =========================================================
           //#12 STATE
           ========================================================= */
        let answers = {};
        let idx = 0;
        let timer = null;
        let tLeft = 10;
        let overallTimer = null;
        let overallLeftMs = Q.length * 10000;
        if (window.__STYLE_V_PRICE == null) window.__STYLE_V_PRICE = 0;
        /* =========================================================
           //#12.5 STORAGE HELPERS
           ========================================================= */
        function extractHouseContext(){
          const aiouHouse = readJSON(AIOU_HOUSE_KEY, {}) || {};
          const bridge = readJSON(BRIDGE_KEY, {}) || {};
          const bridgeHouse = (bridge && bridge.house) ? bridge.house : {};
          const house = {
            bedrooms: aiouHouse.bedrooms ?? bridgeHouse.bedrooms ?? null,
            bathrooms: aiouHouse.bathrooms ?? bridgeHouse.bathrooms ?? null,
            sqft: aiouHouse.sqft ?? bridgeHouse.sqft ?? null,
            propertyType: aiouHouse.propertyType ?? bridgeHouse.propertyType ?? "",
            yearBuilt: aiouHouse.yearBuilt ?? bridgeHouse.yearBuilt ?? null,
            amenities: Array.isArray(aiouHouse.amenities) ? aiouHouse.amenities : (Array.isArray(bridgeHouse.amenities) ? bridgeHouse.amenities : []),
            amenitiesText: aiouHouse.amenitiesText ?? "",
            conditionPreference: aiouHouse.conditionPreference ?? bridgeHouse.conditionPreference ?? null,
            yearBand: aiouHouse.yearBand ?? bridgeHouse.yearBand ?? null,
            styleVsPriceSlider: (aiouHouse.styleVsPriceSlider ?? bridgeHouse.styleVsPriceSlider ?? null),
            mode: aiouHouse.mode ?? bridge._aiouHouseMode ?? null,
            saved_at: aiouHouse.saved_at ?? null,
            _src: aiouHouse._intakeSource ?? "aiou.house.intake"
          };
          return house;
        }
        /* =========================================================
           //#13 HELPERS / UI
           ========================================================= */
        function mmss(ms){
          const s = Math.max(0, Math.ceil(ms/1000));
          const m = Math.floor(s/60);
          const r = s % 60;
          return m+":"+String(r).padStart(2,'0');
        }
        function buildScalePills(){
          const block = $('#scaleBlock');
          block.innerHTML='';
          for (let v=-5; v<=5; v++){
            const pill=document.createElement('div');
            pill.className='pill';
            pill.textContent=String(v);
            pill.dataset.val=v;
            pill.addEventListener('click', ()=>selectValue(v));
            block.appendChild(pill);
          }
        }
        function startQuizFlow(){
          answers = {};
          idx=0;
          Q.forEach(q=>answers[q.id]=undefined);
          overallLeftMs = Q.length * 10000;
          $('#overallClock').textContent = mmss(overallLeftMs);
          if (overallTimer) clearInterval(overallTimer);
          overallTimer = setInterval(()=>{
            overallLeftMs -= 200;
            if (overallLeftMs <= 0){
              overallLeftMs = 0;
              clearInterval(overallTimer);
            }
            $('#overallClock').textContent = mmss(overallLeftMs);
          },200);
          $('#quizCard').classList.remove('hidden');
          $('#resultsCard').classList.add('hidden');
          renderQuestion();
        }
        function renderQuestion(){
          const q = Q[idx];
          $('#qTitle').textContent = `Question ${idx+1} / ${Q.length}`;
          $('#qText').textContent  =
            (q.type==='visual'
              ? 'Where are you between these two options right now?'
              : q.text);
          const visual = $('#visualArea');
          const scale  = $('#scaleBlock');
          if(q.type==='visual'){
            visual.classList.remove('hidden');
            scale.classList.add('hidden');
            initVisualSlider();
          } else {
            visual.classList.add('hidden');
            scale.classList.remove('hidden');
            buildScalePills();
            $$('.pill').forEach(p=>p.dataset.sel='0');
            const prev = answers[q.id];
            if(prev!==undefined && prev!==null){
              const el = $$('.pill').find(x=>Number(x.dataset.val)===prev);
              if(el) el.dataset.sel='1';
            }
          }
          startPerQuestionTimer();
        }
        function startPerQuestionTimer(){
          clearInterval(timer);
          tLeft = 10;
          const bar = $('#qTopTimer');
          if (bar) bar.style.transform='scaleX(1)';
          timer = setInterval(()=>{
            tLeft -= 0.05;
            const frac = Math.max(0, tLeft/10);
            if (bar) bar.style.transform=`scaleX(${frac})`;
            if (tLeft<=0){
              clearInterval(timer);
              recordAnswer(null);
            }
          },50);
        }
        function selectValue(v){
          clearInterval(timer);
          recordAnswer(v);
        }
        function recordAnswer(v){
          const q = Q[idx];
          if(q.type==='visual'){
            const s = $('#vSlider');
            const raw = (v===null ? 0 : Number(s.value||0));
            answers[q.id] = raw;
            window.__STYLE_V_PRICE = raw;
          } else {
            answers[q.id] = (v===null ? 0 : Number(v));
          }
          idx++;
          if(idx < Q.length){
            renderQuestion();
          } else {
            finishQuiz();
          }
        }
        /* =========================================================
           //#14 VISUAL SLIDER SETUP
           ========================================================= */
        function initVisualSlider(){
          const s   = $('#vSlider');
          const lbl = $('#vLabel');
          const imgA= $('#vImgA');
          const imgB= $('#vImgB');
          function explain(v){
            if (v <= -3) return "Prefers Needs Fixes strongly (Option A)";
            if (v === -2 || v === -1) return "Leans Needs Fixes (Option A)";
            if (v === 0) return "Neutral";
            if (v === 1 || v === 2) return "Leans Brand New (Option B)";
            return "Prefers Brand New strongly (Option B)";
          }
          function update(){
            const val = Number(s.value||0);
            window.__STYLE_V_PRICE = val;
            if(lbl){
              lbl.textContent = explain(val);
              s.setAttribute('aria-valuetext', lbl.textContent);
            }
          }
          if (s){
            if (window.__STYLE_V_PRICE==null) window.__STYLE_V_PRICE=0;
            s.value = String(window.__STYLE_V_PRICE||0);
            s.removeEventListener('input', s.__onInput || (()=>{}));
            s.__onInput = ()=>update();
            s.addEventListener('input', s.__onInput);
            update();
          }
          if(imgA){
            imgA.addEventListener('click', ()=>{
              s.value = Math.max(-5,(Number(s.value)||0)-1);
              s.dispatchEvent(new Event('input'));
            });
          }
          if(imgB){
            imgB.addEventListener('click', ()=>{
              s.value = Math.min(5,(Number(s.value)||0)+1);
              s.dispatchEvent(new Event('input'));
            });
          }
        }
        /* =========================================================
           //#15 LOCAL SCORING (fallback)
           ========================================================= */
        function scoreAllLocal(){
          const dims={O:[],C:[],E:[],A:[],N:[]};
          const qMap=Object.fromEntries(Q.map(q=>[q.id,q]));
          Q.forEach(q=>{
            if(q.type==='visual') return;
            let v=answers[q.id];
            if(v===undefined || v===null) v=0;
            if(q.rev) v=-v;
            const mapped=((v+5)*0.4)+1;
            if(dims[q.dim]) dims[q.dim].push(mapped);
          });
          const avg=a=>a.reduce((x,y)=>x+y,0)/a.length || 3;
          const S={
            O:+avg(dims.O).toFixed(2),
            C:+avg(dims.C).toFixed(2),
            E:+avg(dims.E).toFixed(2),
            A:+avg(dims.A).toFixed(2),
            N:+avg(dims.N).toFixed(2)
          };
          const v = Number(window.__STYLE_V_PRICE || 0);
          S.O = +(Math.max(1, Math.min(5, S.O + (v/12.5)))).toFixed(2);
          const flags=[];
          const handled=new Set();
          Q.forEach(q=>{
            if(q.ctrlPair && !handled.has(q.id)){
              const a=answers[q.id];
              const b=answers[q.ctrlPair];
              if(a!=null && b!=null){
                const aAdj=q.rev? -a:a;
                const bAdj=(qMap[q.ctrlPair].rev? -b:b);
                if(Math.abs(aAdj-bAdj)>=6){
                  flags.push(`${q.id}/${q.ctrlPair}`);
                }
              }
              handled.add(q.id);
              handled.add(q.ctrlPair);
            }
          });
          return {scores:S, inconsistencies:flags};
        }
        const MBTI_BUYER_GUIDE = {
          ISTJ:"Stable, detail-first. Prefers proven neighborhoods, low-variance costs, and strong inspection records.",
          ISFJ:"Practical caretaker. Values safety, schools, and quiet streets; favors move-in-ready over projects.",
          INFJ:"Purpose-driven. Wants harmony and meaningful space; calm areas and quality renovations matter.",
          INTJ:"Planner/optimizer. Seeks value efficiency and long-term upside; ignores fluffy upgrades.",
          ISTP:"Hands-on problem-solver. Open to light projects if priced right; needs clear scope/timeline.",
          ISFP:"Aesthetic + comfort. Drawn to warm finishes, natural light, and cozy outdoor spots.",
          INFP:"Idealistic. Wants character and story; needs guardrails so budget doesn’t drift.",
          INTP:"Analytical. Structure/systems/future flexibility > staging glam.",
          ESTP:"Action-oriented. Loves lively areas and entertainment spaces; avoid payment creep.",
          ESFP:"Experience-first. Open layouts and social hubs; size payment first, then pick the fun.",
          ENFP:"Vision + people. Creative layouts, natural light; watch impulsive upgrades.",
          ENTP:"Options hunter. Wants flexibility/ADU potential; negotiate hard.",
          ESTJ:"Structured operator. Predictability, commute efficiency, and low-maintenance wins.",
          ESFJ:"Community anchor. Schools/parks close; turnkey > fixer to keep harmony.",
          ENFJ:"Connector. Hosting flow matters; choose move-in-ready to keep momentum.",
          ENTJ:"Decisive strategist. Location + resale math; newish or quality reno to avoid downtime."
        };
        function mbtiLabel(type){
          const map={
            ISTJ:"Inspector", ISFJ:"Protector", INFJ:"Sage", INTJ:"Architect",
            ISTP:"Crafter",   ISFP:"Artist",    INFP:"Idealist", INTP:"Analyst",
            ESTP:"Promoter",  ESFP:"Performer", ENFP:"Champion", ENTP:"Debater",
            ESTJ:"Executive", ESFJ:"Consul",    ENFJ:"Protagonist", ENTJ:"Commander"
          };
          return map[type] || "Persona";
        }
        function letterEI(E){ return E>=3.75 ? 'E' : (E<=3.25 ? 'I' : (E>=3.5?'E':'I')); }
        function letterSN(O){ return O>=3.75 ? 'N' : (O<=3.25 ? 'S' : (O>=3.5?'N':'S')); }
        function letterTF(A){ return A>=3.75 ? 'F' : (A<=3.25 ? 'T' : (A>=3.5?'F':'T')); }
        function letterJP(C){ return C>=3.75 ? 'J' : (C<=3.25 ? 'P' : (C>=3.5?'J':'P')); }
        function scoresToMBTILocal(S){
          const ei=letterEI(S.E),
                sn=letterSN(S.O),
                tf=letterTF(S.A),
                jp=letterJP(S.C);
          const type=`${ei}${sn}${tf}${jp}`;
          const dist=(v,hi=true)=> hi? Math.max(0,v-3.5)/1.5 : Math.max(0,3.5-v)/1.5;
          const parts=[
            ei==='E'?dist(S.E,true):dist(S.E,false),
            sn==='N'?dist(S.O,true):dist(S.O,false),
            tf==='F'?dist(S.A,true):dist(S.A,false),
            jp==='J'?dist(S.C,true):dist(S.C,false)
          ];
          const confidence=Math.max(0.35,
            +(parts.reduce((a,b)=>a+b,0)/4).toFixed(2)
          );
          return { type, confidence };
        }
        /* =========================================================
           //#16 SERVER SCORING
           ========================================================= */
        async function scoreViaServer(payload){
          const SCORE_ENDPOINT = (
            document.querySelector('#aiou-shell')?.dataset?.scoreEndpoint
            || 'https://theorozcorealty.netlify.app/.netlify/functions/aiou-score'
          ).trim();
          const r = await fetch(SCORE_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          if (!r.ok) throw new Error('Score server returned ' + r.status);
          const data = await r.json();
          if (!data || data.ok !== true) throw new Error((data && data.error) ? data.error : 'Score response not ok');
          return data;
        }
        /* =========================================================
           //#17 FINISH QUIZ -> SHOW RESULTS -> AUTO REPORT
           ========================================================= */
        function finishQuiz(){
          $('#quizCard').classList.add('hidden');
          if (overallTimer) clearInterval(overallTimer);
          $('#resultsCard').classList.remove('hidden');
          $('#kO').textContent = '—';
          $('#kC').textContent = '—';
          $('#kE').textContent = '—';
          $('#kA').textContent = '—';
          $('#kN').textContent = '—';
          $('#consistency').innerHTML = '';
          $('#archetype').textContent = '';
          $('#mbti').innerHTML = '';
          $('#jsonReportBox').innerHTML = '(Generating your personalized memo…)';
          const profile = {
            firstName: $('#firstName').value.trim(),
            lastName:  $('#lastName').value.trim(),
            bedrooms:  Number($('#bedrooms').value||0),
            budgetMax: Number($('#budget').value||0),
            setting:   $('#setting').value,
            safetyPriority: Number($('#safety').value||3)
          };
          const house = extractHouseContext();
          const styleVsPriceSlider = Number(window.__STYLE_V_PRICE ?? 0);
          const scorePayload = {
            answers: Object.assign({}, answers),
            styleVsPriceSlider: styleVsPriceSlider,
            conditionPreference: house.conditionPreference ?? null
          };
          (async ()=>{
            let scores, inconsistencies, archetype, mbti, mbtiBlurb;
            try{
              const scored = await scoreViaServer(scorePayload);
              scores = scored.scores || null;
              inconsistencies = scored.inconsistencies || [];
              archetype = scored.archetype || 'Balanced Explorer';
              mbti = scored.mbti || null;
              mbtiBlurb = (mbti && mbti.blurb) ? mbti.blurb : '';
            }catch(_err){
              const local = scoreAllLocal();
              scores = local.scores;
              inconsistencies = local.inconsistencies;
              archetype=(function(s){
                const hi=v=>v>=4.0, lo=v=>v<=2.5;
                if(hi(s.O)&&hi(s.E)) return 'Visionary Host';
                if(hi(s.C)&&!hi(s.O)&&!hi(s.E)) return 'Steady Planner';
                if(hi(s.N)&&lo(s.E)) return 'Risk-Guarded Nest-Builder';
                if(hi(s.A)&&hi(s.C)) return 'Family-First Optimizer';
                if(hi(s.O)&&s.N<3.3) return 'Design-Forward Adventurer';
                return 'Balanced Explorer';
              })(scores);
              const mbLocal = scoresToMBTILocal(scores);
              const blurbLocal = MBTI_BUYER_GUIDE[mbLocal.type]
                || "Personality informs your tradeoffs; we’ll size budget first, then match how you live.";
              mbti = {
                type: mbLocal.type,
                confidence: mbLocal.confidence,
                label: mbtiLabel(mbLocal.type),
                blurb: blurbLocal
              };
              mbtiBlurb = blurbLocal;
            }
            $('#kO').textContent = Number(scores.O).toFixed(2);
            $('#kC').textContent = Number(scores.C).toFixed(2);
            $('#kE').textContent = Number(scores.E).toFixed(2);
            $('#kA').textContent = Number(scores.A).toFixed(2);
            $('#kN').textContent = Number(scores.N).toFixed(2);
            $('#archetype').textContent = `Archetype: ${archetype}`;
            const mbType = (mbti && mbti.type) ? mbti.type : 'INTJ';
            const mbConf = (mbti && typeof mbti.confidence === 'number') ? mbti.confidence : 0.5;
            const mbLbl  = (mbti && mbti.label) ? mbti.label : mbtiLabel(mbType);
            const blurb  = mbtiBlurb || (MBTI_BUYER_GUIDE[mbType] || "Personality informs your tradeoffs; we’ll size budget first, then match how you live.");
            $('#mbti').innerHTML =
              `MBTI: <b>${mbType}</b> — ${mbLbl} ` +
              `<span style="opacity:.7">(${(mbConf*100).toFixed(0)}% match)</span><br>` +
              `<span style="color:var(--muted);font-weight:400;">${blurb}</span>`;
            $('#consistency').innerHTML = (inconsistencies && inconsistencies.length)
              ? `<span class="flag">⚠ Consistency flags:</span> ${inconsistencies.join(', ')}`
              : `<span class="ok">✓ Responses appear consistent across rephrased items.</span>`;
            const brief = {
              version:'aiou.v3.timed',
              ts:new Date().toISOString(),
              profile,
              house,
              scores,
              archetype,
              mbti,
              psych:{
                totalItems: Q.length,
                inconsistencies,
                answers: Object.assign({}, answers)
              },
              visual:{
                styleVsPriceSlider: styleVsPriceSlider
              }
            };
            sendToLLM(brief);
          })();
        }
        /* =========================================================
           //#18 CALL NETLIFY FUNCTION
           ========================================================= */
        async function sendToLLM(brief){
          const ENDPOINT = (
            document.querySelector('#aiou-shell')?.dataset?.endpoint
            || 'https://theorozcorealty.netlify.app/.netlify/functions/aiou-report'
          ).trim();
          const box = $('#jsonReportBox');
          box.innerHTML = '(Generating your personalized memo…)';
          try{
            const r = await fetch(ENDPOINT,{
              method:'POST',
              headers:{'Content-Type':'application/json'},
              body:JSON.stringify(brief)
            });
            if(!r.ok) throw new Error('Server returned '+r.status);
            const data = await r.json();
            const html =
              data.memoHtml
              || (data.memo
                  ? `<p>${String(data.memo).replace(/</g,'&lt;')}</p>`
                  : '<p>No memo returned.</p>');
            box.innerHTML = html;
            if (data.hydratedProfile){
              if (!$('#firstName').value && data.hydratedProfile.firstName){
                $('#firstName').value = data.hydratedProfile.firstName;
              }
              if (!$('#lastName').value && data.hydratedProfile.lastName){
                $('#lastName').value = data.hydratedProfile.lastName;
              }
            }
          }catch(e){
            box.innerHTML = `<span class="flag">Error: ${e.message}</span>`;
          }
        }
        /* =========================================================
           //#19 BUTTON HANDLERS
           ========================================================= */
        $('#startQuiz').addEventListener('click', startQuizFlow);
        $('#skip').addEventListener('click', ()=>{ recordAnswer(null); });
        $('#reset').addEventListener('click', ()=>{
          if (overallTimer) clearInterval(overallTimer);
          startQuizFlow();
        });
        $('#closePortal').addEventListener('click', ()=>{
          if (overallTimer) clearInterval(overallTimer);
          portal.remove();
        });
        $('#quizCard').classList.add('hidden');
        $('#resultsCard').classList.add('hidden');
      });
    })();
  </script>
      </div>
    </div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=69658389f59da527c04bcbd4" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
</body>
</html>