<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Wed Jan 14 2026 23:15:35 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="6966d047ed1504d7dd71e8e8" data-wf-site="69658389f59da527c04bcbd4" lang="en">
<head>
  <meta charset="utf-8">
  <title>VA Buyers Guide</title>
  <meta content="All-in-One Source for your VA-Buyers-Guide. This A.I Driven platform provides detailed explanations for VA related questions. Learn, Discover, Ask." name="description">
  <meta content="VA Buyers Guide" property="og:title">
  <meta content="All-in-One Source for your VA-Buyers-Guide. This A.I Driven platform provides detailed explanations for VA related questions. Learn, Discover, Ask." property="og:description">
  <meta content="https://cdn.prod.website-files.com/69658389f59da527c04bcbd4/6965871218b5681ffd7cdba1_US.jpg" property="og:image">
  <meta content="VA Buyers Guide" property="twitter:title">
  <meta content="All-in-One Source for your VA-Buyers-Guide. This A.I Driven platform provides detailed explanations for VA related questions. Learn, Discover, Ask." property="twitter:description">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/pcs-united.webflow.css" rel="stylesheet" type="text/css">
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <div class="w-embed"><!--  ============================================================
PCSUnited • VA BUYER’S GUIDE (SHELL ONLY) — v1.0
Embed #1/2 — HTML + CSS (NO JS)
Theme goal: Simple, powerful, military-trusted HUD (matches PCSUnited dashboard)
============================================================  -->
    <div id="va-guide-ui" style="all: initial;">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
      <style>
    /* ============================================================
      //#1 RESET (SCOPED)
    ============================================================ */
    #va-guide-ui, #va-guide-ui *{
      box-sizing:border-box;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    /* ============================================================
      //#2 PCSUNITED TOKENS (DARK HUD)
    ============================================================ */
    #va-guide-ui{
      --bg0:#0b1424;
      --bg1:#0a1220;
      --panel:#111b2a;
      --panel2:#0f1927;
      --card:#0f1726;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.06);
      --ink:#eaf0ff;
      --muted:rgba(234,240,255,.72);
      --muted2:rgba(234,240,255,.55);
      --blue:#6aa7ff;
      --blue2:#3f74ff;
      --teal:#8ef3c5;
      --good:#5bd67d;
      --warn:#f3c969;
      --bad:#ff5c5c;
      --shadow: 0 20px 45px rgba(0,0,0,.55);
      --shadow2: 0 10px 24px rgba(0,0,0,.45);
      display:block;
      width:100%;
      min-height: 100%;
      color: var(--ink);
      padding: 22px;
      background:
        radial-gradient(1000px 600px at 22% -10%, rgba(106,167,255,.18), rgba(10,18,32,0) 60%),
        radial-gradient(900px 500px at 82% 0%, rgba(142,243,197,.12), rgba(10,18,32,0) 55%),
        radial-gradient(900px 700px at 50% 115%, rgba(0,0,0,.55), rgba(10,18,32,0) 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }
    /* ============================================================
      //#3 WRAP + GRID
    ============================================================ */
    .va-wrap{
      width:100%;
      max-width: 1320px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 340px 1fr;
      gap: 16px;
      align-items:start;
    }
    /* ============================================================
      //#4 “GLASS” PANEL + HEADER STRIP STYLE
    ============================================================ */
    .va-panel{
      background: linear-gradient(180deg, rgba(17,27,42,.92), rgba(12,19,33,.92));
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .va-panel:before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(800px 260px at 50% -20%, rgba(255,255,255,.10), rgba(255,255,255,0) 55%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0));
      opacity:.65;
    }
    .va-inner{ position:relative; z-index:1; }
    /* ============================================================
      //#5 TOP “DASHBOARD” STRIP
    ============================================================ */
    .va-top{
      grid-column: 1 / -1;
      padding: 14px 14px 12px;
    }
    .va-top-grid{
      display:grid;
      grid-template-columns: 1.15fr 1fr 1fr 1fr;
      gap: 12px;
      align-items:stretch;
    }
    .va-kpi{
      border-radius: 14px;
      border: 1px solid var(--line2);
      background: linear-gradient(180deg, rgba(10,18,32,.75), rgba(10,18,32,.55));
      box-shadow: var(--shadow2);
      padding: 12px 12px 10px;
      min-height: 72px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap: 8px;
    }
    .va-kpi .label{
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted2);
      font-weight: 900;
    }
    .va-kpi .value{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 10px;
    }
    .va-title{
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -.01em;
      color: var(--ink);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .va-sub{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .va-chip{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line2);
      background: rgba(10,18,32,.55);
      color: var(--muted);
      font-size: 12px;
      white-space:nowrap;
    }
    .va-chip b{ color: var(--ink); }
    .va-meter{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .va-meter > i{
      display:block;
      height:100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--teal), var(--blue));
      transition: width .25s ease;
    }
    /* Search strip inside KPI */
    .va-search{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(10,18,32,.55);
    }
    .va-search svg{ width: 16px; height: 16px; opacity: .75; color: var(--muted); }
    .va-search input{
      width:100%;
      border:0;
      outline:none;
      background: transparent;
      color: var(--ink);
      font-size: 13px;
    }
    .va-search input::placeholder{ color: rgba(234,240,255,.45); }
    /* ============================================================
      //#6 SIDEBAR (TOPICS)
    ============================================================ */
    .va-side{
      position: sticky;
      top: 18px;
    }
    .va-side-head{
      padding: 14px 14px 12px;
      border-bottom: 1px solid var(--line2);
      background: linear-gradient(180deg, rgba(10,18,32,.55), rgba(10,18,32,.25));
    }
    .va-side-head h2{
      margin:0;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted2);
      font-weight: 900;
    }
    .va-side-head p{
      margin: 8px 0 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    #va-nav{
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      max-height: calc(100vh - 200px);
      overflow:auto;
    }
    /* Scrollbar (subtle) */
    #va-nav::-webkit-scrollbar{ width: 10px; }
    #va-nav::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }
    .va-nav-btn{
      width:100%;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(15,23,38,.85), rgba(10,18,32,.55));
      color: var(--ink);
      cursor:pointer;
      text-align:left;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.32);
    }
    .va-nav-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(106,167,255,.35);
      box-shadow: 0 14px 28px rgba(0,0,0,.44);
    }
    .va-nav-btn[aria-selected="true"]{
      border-color: rgba(142,243,197,.42);
      box-shadow: 0 18px 34px rgba(0,0,0,.52);
      background:
        radial-gradient(700px 220px at 30% 0%, rgba(142,243,197,.18), rgba(10,18,32,0) 55%),
        linear-gradient(180deg, rgba(15,23,38,.92), rgba(10,18,32,.60));
    }
    .va-ic{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(10,18,32,.55);
      display:grid;
      place-items:center;
      color: var(--blue);
      font-weight: 900;
      flex: 0 0 auto;
      user-select:none;
    }
    .va-nav-meta{
      display:flex;
      flex-direction:column;
      gap: 3px;
      min-width:0;
    }
    .va-nav-meta b{
      font-size: 13px;
      font-weight: 900;
      color: var(--ink);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .va-nav-meta span{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    /* ============================================================
      //#7 MAIN CONTENT (CARDS LIKE YOUR DASHBOARD)
    ============================================================ */
    .va-main{
      padding: 14px;
    }
    .va-hero{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(1000px 340px at 25% 0%, rgba(106,167,255,.16), rgba(10,18,32,0) 60%),
        linear-gradient(180deg, rgba(15,23,38,.92), rgba(10,18,32,.60));
      box-shadow: 0 18px 40px rgba(0,0,0,.48);
      padding: 14px 14px 12px;
    }
    .va-hero h3{
      margin:0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .02em;
      text-transform: uppercase;
    }
    .va-hero p{
      margin: 8px 0 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.55;
      max-width: 80ch;
    }
    .va-grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 12px;
      align-items:start;
    }
    .va-card{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(15,23,38,.88), rgba(10,18,32,.55));
      box-shadow: 0 18px 40px rgba(0,0,0,.44);
      padding: 12px;
    }
    .va-card h4{
      margin:0 0 10px;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(234,240,255,.88);
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .va-list{
      margin:0;
      padding-left: 18px;
      font-size: 13px;
      color: var(--ink);
      line-height: 1.55;
    }
    .va-list li{ margin: 7px 0; color: rgba(234,240,255,.92); }
    .va-subnote{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
      border-top: 1px solid rgba(255,255,255,.08);
      padding-top: 10px;
    }
    .va-row{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      margin-top: 10px;
    }
    .va-btn{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(10,18,32,.55);
      color: var(--ink);
      padding: 9px 12px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
    }
    .va-btn:hover{ transform: translateY(-1px); border-color: rgba(106,167,255,.30); }
    .va-btn.primary{
      border-color: rgba(142,243,197,.30);
      background: radial-gradient(circle at 30% 30%, rgba(142,243,197,.25), rgba(10,18,32,.55));
    }
    /* ============================================================
      //#8 “ASK PCS” MINI DOCK (OPTIONAL PLACEHOLDER)
      - Pure UI only; wired later by Embed #2 if you want.
    ============================================================ */
    .va-dock{
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: min(380px, calc(100vw - 36px));
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(10,18,32,.66);
      box-shadow: 0 22px 60px rgba(0,0,0,.60);
      backdrop-filter: blur(10px);
      padding: 12px;
      z-index: 999;
    }
    .va-dock .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .va-dock .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width:0;
    }
    .va-avatar{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: radial-gradient(circle at 30% 30%, rgba(106,167,255,.20), rgba(10,18,32,.55));
      display:grid;
      place-items:center;
      color: var(--blue);
      font-weight: 900;
      user-select:none;
    }
    .va-dock h5{
      margin:0;
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(234,240,255,.90);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .va-dock p{
      margin:4px 0 0;
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .va-input{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(15,23,38,.70);
    }
    .va-input input{
      width: 100%;
      border:0;
      outline:none;
      background: transparent;
      color: var(--ink);
      font-size: 13px;
    }
    .va-send{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(142,243,197,.22);
      background: rgba(142,243,197,.10);
      display:grid;
      place-items:center;
      cursor:pointer;
      color: var(--teal);
      flex: 0 0 auto;
    }
    /* ============================================================
      //#9 RESPONSIVE
    ============================================================ */
    @media (max-width: 980px){
      #va-guide-ui{ padding: 16px; }
      .va-wrap{ grid-template-columns: 1fr; }
      .va-side{ position: relative; top:auto; }
      .va-top-grid{ grid-template-columns: 1fr; }
      .va-grid{ grid-template-columns: 1fr; }
      .va-dock{ right: 12px; bottom: 12px; width: min(380px, calc(100vw - 24px)); }
      #va-nav{ max-height: 420px; }
    }
  </style>
      <div class="va-wrap">
        <!--  ============================================================
      //#10 TOP STRIP (KPI ROW)
    ============================================================  -->
        <section class="va-panel va-top" aria-label="VA Guide dashboard strip">
          <div class="va-inner">
            <div class="va-top-grid">
              <!--  KPI 1: Title  -->
              <div class="va-kpi">
                <div>
                  <div class="label">PCSUnited</div>
                  <div class="va-title">VA Buyer’s Guide</div>
                  <div class="va-sub">Simple mode • “what it means” first</div>
                </div>
                <div class="va-row">
                  <span class="va-chip">Mode: <b>Quick + Official</b></span>
                </div>
              </div>
              <!--  KPI 2: Search  -->
              <div class="va-kpi">
                <div class="label">Search the guide</div>
                <div class="va-search">
                  <svg viewbox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6"></path>
                    <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"></path>
                  </svg>
                  <input id="va-search" type="search" placeholder="funding fee, COE, entitlement, closing costs…" autocomplete="off">
                </div>
              </div>
              <!--  KPI 3: Progress  -->
              <div class="va-kpi">
                <div class="label">Progress</div>
                <div class="va-chip">Complete: <b id="va-progress-text">0 of 0</b></div>
                <div class="va-meter" aria-label="Progress meter">
                  <i id="va-progress-bar"></i>
                </div>
                <div class="va-sub">Saved to this browser.</div>
              </div>
              <!--  KPI 4: Source  -->
              <div class="va-kpi">
                <div class="label">Source</div>
                <div class="va-chip">Official: <b>VA Buyer’s Guide (PDF)</b></div>
                <div class="va-sub">Your Embed #2 will power “Read official text”.</div>
                <div class="va-row">
                  <button class="va-btn primary" type="button">Open official PDF</button>
                  <button class="va-btn" type="button">Ask PCS</button>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!--  ============================================================
      //#11 SIDEBAR (TOPIC LIST)
    ============================================================  -->
        <aside class="va-panel va-side" aria-label="Topics sidebar">
          <div class="va-inner">
            <div class="va-side-head">
              <h2>Topics</h2>
              <p>Pick a topic. You’ll get the simple explanation first, then you can open the official section when you want details.</p>
            </div>
            <nav id="va-nav">
              <!--  Placeholder (JS will replace)  -->
              <button class="va-nav-btn" type="button" aria-selected="true">
                <span class="va-ic">1</span>
                <span class="va-nav-meta">
                  <b>Start Here</b>
                  <span>What the VA loan does</span>
                </span>
              </button>
              <button class="va-nav-btn" type="button" aria-selected="false">
                <span class="va-ic">2</span>
                <span class="va-nav-meta">
                  <b>Eligibility</b>
                  <span>COE + basic requirements</span>
                </span>
              </button>
            </nav>
          </div>
        </aside>
        <!--  ============================================================
      //#12 MAIN CONTENT (CONTENT CARDS)
    ============================================================  -->
        <main class="va-panel" aria-label="Guide content area">
          <div class="va-inner">
            <div class="va-main" id="va-content">
              <!--  Default view (JS will replace)  -->
              <div class="va-hero">
                <h3>Start Here</h3>
                <p>
                  This is the PCSUnited-style shell. Embed #2 will load topics from your JSON endpoint and render
                  “Simple explanation” + “Official guide text” (expand on demand).
                </p>
                <div class="va-row">
                  <button class="va-btn primary" type="button">Next Topic</button>
                  <button class="va-btn" type="button">Show Official Text</button>
                </div>
              </div>
              <div class="va-grid">
                <section class="va-card">
                  <h4>In plain English <span style="color:var(--muted2); font-weight:800; letter-spacing:.08em;">(fast)</span></h4>
                  <ul class="va-list">
                    <li>VA isn’t the lender — your bank/credit union is.</li>
                    <li>VA backing helps you buy with less cash up front.</li>
                    <li>You still must qualify and the home must appraise.</li>
                  </ul>
                  <div class="va-subnote">
                    Embed #2 can use your ChatGPT API (optional) to rewrite official text into simple bullets — while keeping the official passage accessible.
                  </div>
                </section>
                <section class="va-card">
                  <h4>Official Text <span style="color:var(--muted2); font-weight:800; letter-spacing:.08em;">(source)</span></h4>
                  <div class="va-subnote">
                    Collapsed by default. User expands only when they want details (no overwhelm).
                  </div>
                  <div style="
                margin-top:10px;
                padding:12px;
                border-radius:14px;
                border:1px solid rgba(255,255,255,.10);
                background: rgba(10,18,32,.45);
                color: var(--muted);
                font-size:13px;
                line-height:1.55;">
                    Tap “Show Official Text” to expand the exact VA guide passage for this topic.
                  </div>
                </section>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!--  ============================================================
    //#13 OPTIONAL DOCK (UI ONLY)
  ============================================================  -->
      <section class="va-dock" aria-label="Ask PCS dock">
        <div class="top">
          <div class="brand">
            <div class="va-avatar">P</div>
            <div style="min-width:0;">
              <h5>ASK PCS</h5>
              <p>Quick answers from the guide</p>
            </div>
          </div>
          <span class="va-chip" style="padding:7px 10px;">Beta</span>
        </div>
        <div class="va-input">
          <input type="text" placeholder="Ask: Can I finance closing costs? What is the Escape Clause?…">
          <button class="va-send" type="button" aria-label="Send">
            <svg viewbox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
              <path d="M3 11.5 21 3l-8.5 18-2.8-7.1L3 11.5Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"></path>
            </svg>
          </button>
        </div>
      </section>
    </div>
  </div>
  <div class="w-embed w-script">
    <script>
(() => {
  "use strict";
  // ============================================================
  // PCSUnited • VA BUYER’S GUIDE (EMBED #2) — v1.0
  // PURPOSE:
  // - Use ONLY 6 top-level topics (no overwhelm)
  // - Pull guide JSON from Netlify endpoint (/api/va-guide)
  // - Render: Bucket → Sub-sections (accordion)
  // - Provide: Search (Spotlight-ish), Progress, “Ask PCS” helpers
  //
  // REQUIRED DOM (from Embed #1):
  // - #va-search
  // - #va-nav
  // - #va-content
  // - #va-progress-text
  // - #va-progress-bar
  // ============================================================
  // ============================================================
  // //#1 HARD SETTINGS (EDIT THESE IF NEEDED)
  // ============================================================
  // Best practice: keep Netlify API_BASE (Webflow pages won’t host /api)
  // This code will auto-try multiple candidates, so you don’t get stuck.
  const API_CANDIDATES = [
    "https://pcs-united.netlify.app/api",
    "https://theorozcorealty.netlify.app/api"
  ];
  // Optional: PDF URL (only used for “Open PDF at page” links)
  const PDF_URL = ""; // e.g. "https://uploads-ssl.webflow.com/.../VA_Buyers_Guide.pdf"
  // Progress storage
  const LS_PROGRESS = "pcs_va_guide_progress_v1";
  // UI limits
  const MAX_SEARCH_RESULTS = 12;
  // ============================================================
  // //#2 DOM + SAFE GUARDS
  // ============================================================
  const navEl = document.getElementById("va-nav");
  const contentEl = document.getElementById("va-content");
  const searchEl = document.getElementById("va-search");
  const progressTextEl = document.getElementById("va-progress-text");
  const progressBarEl = document.getElementById("va-progress-bar");
  if (!navEl || !contentEl) return;
  if (window.__PCS_VA_GUIDE_MOUNTED__) return;
  window.__PCS_VA_GUIDE_MOUNTED__ = true;
  // ============================================================
  // //#3 UTILS
  // ============================================================
  const $qs = (sel, root = document) => root.querySelector(sel);
  function esc(s) {
    return String(s ?? "").replace(/[&<>"']/g, (c) => ({
      "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
    }[c]));
  }
  function safeJSONParse(str, fallback) {
    try {
      if (str == null) return fallback;
      const v = JSON.parse(str);
      return v == null ? fallback : v;
    } catch {
      return fallback;
    }
  }
  function safeProgress(obj) {
    let p = obj;
    if (!p || typeof p !== "object" || Array.isArray(p)) p = {};
    if (!p.done || typeof p.done !== "object" || Array.isArray(p.done)) p.done = {};
    return p;
  }
  function setLS(key, val) {
    try { localStorage.setItem(key, JSON.stringify(val)); } catch {}
  }
  function getLS(key, fallback) {
    return safeJSONParse(localStorage.getItem(key), fallback);
  }
  function debounce(fn, ms = 180) {
    let t = null;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), ms);
    };
  }
  function pdfLink(page) {
    if (!PDF_URL) return "";
    const p = Math.max(1, Number(page || 1));
    return `${PDF_URL}#page=${p}`;
  }
  function moneyLike(n) {
    const x = Number(n);
    if (!Number.isFinite(x)) return "—";
    return x.toLocaleString("en-US");
  }
  // ============================================================
  // //#4 DATA MODEL
  // ============================================================
  let API_BASE = null;
  let GUIDE = null; // JSON from /api/va-guide (full)
  let SECTIONS = []; // normalized
  let BUCKETS = []; // 6 buckets
  let ACTIVE_BUCKET_ID = "eligibility-coe";
  let ACTIVE_VIEW = "bucket"; // "bucket" | "search"
  // progress
  let progress = safeProgress(getLS(LS_PROGRESS, {}));
  function saveProgress() {
    progress = safeProgress(progress);
    setLS(LS_PROGRESS, progress);
    paintProgress();
  }
  function isDone(sectionKey) {
    progress = safeProgress(progress);
    return !!progress.done[sectionKey];
  }
  function setDone(sectionKey, val) {
    progress = safeProgress(progress);
    progress.done[sectionKey] = !!val;
    saveProgress();
  }
  // ============================================================
  // //#5 FETCH: find a working API_BASE
  // ============================================================
  async function tryFetchJSON(url) {
    const res = await fetch(url, { method: "GET", cache: "no-store" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  }
  async function resolveAPIBase() {
    // also try same-origin /api if it’s a Netlify host (not webflow)
    const host = String(location.hostname || "");
    const isWebflow = host.includes("webflow.io");
    const originCandidate = !isWebflow ? `${location.origin}/api` : null;
    const candidates = [
      ...(originCandidate ? [originCandidate] : []),
      ...API_CANDIDATES.filter(Boolean)
    ];
    for (const base of candidates) {
      try {
        const probe = await tryFetchJSON(`${base}/va-guide?lite=1`);
        if (probe && probe.ok) return base;
      } catch (e) {
        // keep trying
      }
    }
    return null;
  }
  // ============================================================
  // //#6 NORMALIZE SECTIONS
  // ============================================================
  function normalizeSections(guide) {
    const arr = Array.isArray(guide?.sections) ? guide.sections : [];
    const pages = Array.isArray(guide?.pages) ? guide.pages : [];
    const pageMap = new Map();
    for (const p of pages) pageMap.set(Number(p.page), String(p.text || ""));
    const norm = arr.map((s, idx) => {
      const title = String(s.title || "").trim() || `Section ${idx + 1}`;
      const id = String(s.id || "").trim() || `sec-${idx + 1}`;
      const start = Math.max(1, Number(s.start_page || 1));
      const end = Math.max(start, Number(s.end_page || start));
      return {
        key: id, // stable key for progress
        id,
        title,
        start_page: start,
        end_page: end,
        __idx: idx,
        __pageMap: pageMap
      };
    });
    return norm;
  }
  function getSectionText(sec) {
    const start = sec.start_page;
    const end = sec.end_page;
    const parts = [];
    for (let p = start; p <= end; p++) {
      const t = sec.__pageMap.get(p);
      if (t) parts.push(t);
    }
    return parts.join("\n\n").trim();
  }
  // ============================================================
  // //#7 “PLAIN ENGLISH” SUMMARY (LOCAL, NO API)
  // - Keeps it deterministic, fast, and safe
  // ============================================================
  function buildPlainEnglish(text) {
    const cleaned = String(text || "")
      .replace(/\s+\n/g, "\n")
      .replace(/\n{3,}/g, "\n\n")
      .trim();
    if (!cleaned) return ["No extractable text for this section."];
    // Prefer bullet-ish lines
    const lines = cleaned.split("\n").map(s => s.trim()).filter(Boolean);
    const bulletish = lines.filter(l => /^(\-|\•|\u2022)/.test(l));
    if (bulletish.length >= 3) {
      return bulletish
        .slice(0, 6)
        .map(x => x.replace(/^(\-|\•|\u2022)\s*/, "").trim())
        .filter(Boolean);
    }
    // Sentence-ish fallback
    const flat = cleaned.replace(/\n+/g, " ");
    const sentences = flat.split(/(?<=[.!?])\s+/).map(s => s.trim()).filter(Boolean);
    // “Apple simple”: 3–5 short takeaways
    const out = [];
    for (const s of sentences) {
      if (out.length >= 5) break;
      if (s.length < 35) continue;
      out.push(s.length > 140 ? (s.slice(0, 140).trim() + "…") : s);
    }
    return out.length ? out : [sentences[0] || cleaned.slice(0, 160) + "…"];
  }
  function snippet(text, q) {
    const t = String(text || "");
    const qq = String(q || "").trim().toLowerCase();
    if (!qq) return "";
    const idx = t.toLowerCase().indexOf(qq);
    if (idx < 0) return "";
    const start = Math.max(0, idx - 70);
    const end = Math.min(t.length, idx + 170);
    return t.slice(start, end).replace(/\s+/g, " ").trim();
  }
  // ============================================================
  // //#8 6 BUCKETS (NO MORE)
  // ============================================================
  function buildBuckets(sections) {
    const buckets = [
      {
        id: "eligibility-coe",
        label: "Eligibility + COE",
        icon: "E",
        hint: "Who qualifies and how to prove it",
        rules: [
          /eligib/i, /certificate of eligibility/i, /\bcoe\b/i
        ]
      },
      {
        id: "money-approval",
        label: "Money + Approval",
        icon: "$",
        hint: "Credit, income, assets, DTI, closing costs",
        rules: [
          /credit/i, /income/i, /assets?/i, /downpayment/i, /closing costs/i, /before borrowing/i
        ]
      },
      {
        id: "benefit-mechanics",
        label: "VA Benefit Mechanics",
        icon: "V",
        hint: "Entitlement, funding fee, loan limits",
        rules: [
          /entitlement/i, /loan limits/i, /funding fee/i, /guaranty/i, /restoration/i, /substitution/i, /remaining entitlement/i, /supplemental/i, /one-time/i, /counties/i
        ]
      },
      {
        id: "standards-appraisal",
        label: "Standards + Appraisal",
        icon: "A",
        hint: "MPRs, appraisal, NOV, ROV, inspections",
        rules: [
          /appraisal/i, /\bnov\b/i, /mpr/i, /minimum property requirements/i, /\brov\b/i, /inspection/i
        ]
      },
      {
        id: "buying-process",
        label: "The Buying Process",
        icon: "P",
        hint: "Lender → offer → escape clause → closing",
        rules: [
          /home loan process/i, /finding a lender/i, /pre-qual/i, /pre-approval/i, /making an offer/i, /escape clause/i, /reviewing and signing/i, /closing\b/i
        ]
      },
      {
        id: "after-closing",
        label: "After Closing + Next Moves",
        icon: "→",
        hint: "IRRRL, assumption, FAQs, contacts",
        rules: [
          /after closing/i, /irr/i, /irrrl/i, /assumption/i, /frequently asked/i, /helpful contacts/i, /tips/i, /valuable resource/i
        ]
      }
    ];
    // Assign each section to best bucket based on title matches
    const assigned = buckets.map(b => ({ ...b, items: [] }));
    for (const sec of sections) {
      const t = sec.title.toLowerCase();
      let best = null;
      for (const b of assigned) {
        if (b.rules.some(rx => rx.test(t))) { best = b; break; }
      }
      // fallback: shove “overview/outline” into Buying Process (or first)
      if (!best) {
        if (/overview|outline/.test(t)) best = assigned.find(x => x.id === "buying-process") || assigned[0];
        else best = assigned.find(x => x.id === "money-approval") || assigned[0];
      }
      best.items.push(sec);
    }
    // Sort items inside buckets by start_page to feel “guided”
    for (const b of assigned) {
      b.items.sort((a, c) => (a.start_page - c.start_page) || (a.__idx - c.__idx));
    }
    return assigned;
  }
  // ============================================================
  // //#9 RENDER: NAV (6 TOPICS ONLY)
  // ============================================================
  function navButtonHTML(bucket, selected) {
    const doneCount = bucket.items.reduce((acc, it) => acc + (isDone(it.key) ? 1 : 0), 0);
    const total = bucket.items.length;
    const pct = total ? Math.round((doneCount / total) * 100) : 0;
    return `
      <button class="va-nav-btn" type="button" data-bucket="${esc(bucket.id)}" aria-selected="${selected ? "true" : "false"}">
        <span class="va-ic">${esc(bucket.icon)}</span>
        <span class="va-nav-meta">
          <b>${esc(bucket.label)}</b>
          <span>${esc(bucket.hint)} • ${moneyLike(doneCount)} / ${moneyLike(total)} (${pct}%)</span>
        </span>
      </button>
    `;
  }
  function renderNav() {
    navEl.innerHTML = BUCKETS.map(b => navButtonHTML(b, b.id === ACTIVE_BUCKET_ID)).join("");
    navEl.querySelectorAll(".va-nav-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-bucket");
        if (!id) return;
        ACTIVE_BUCKET_ID = id;
        ACTIVE_VIEW = "bucket";
        renderAll();
      });
    });
  }
  // ============================================================
  // //#10 RENDER: PROGRESS (ACROSS ALL SUB-SECTIONS)
  // ============================================================
  function paintProgress() {
    const allItems = BUCKETS.flatMap(b => b.items);
    const total = allItems.length || 0;
    const done = allItems.reduce((acc, it) => acc + (isDone(it.key) ? 1 : 0), 0);
    const pct = total ? Math.round((done / total) * 100) : 0;
    if (progressTextEl) progressTextEl.textContent = `${done} of ${total}`;
    if (progressBarEl) progressBarEl.style.width = `${pct}%`;
  }
  // ============================================================
  // //#11 ASK PCS (SMART PREFILL)
  // - We don’t assume any “send” logic yet.
  // - We just prefill the dock input if it exists.
  // ============================================================
  function prefillAskPCS(question) {
    const dockInput =
      document.querySelector(".va-dock input") ||
      document.querySelector(".va-input input") ||
      document.querySelector('input[placeholder*="Ask"]');
    if (dockInput) {
      dockInput.value = question;
      dockInput.focus({ preventScroll: true });
      // light nudge: scroll into view if it’s offscreen
      try { dockInput.scrollIntoView({ behavior: "smooth", block: "center" }); } catch {}
    }
  }
  function suggestedQuestionForSection(sec) {
    const t = sec.title.toLowerCase();
    if (t.includes("funding fee")) return "Am I exempt from the VA funding fee? If not, how is it calculated?";
    if (t.includes("entitlement")) return "How does VA entitlement work, and how do I know what I have left?";
    if (t.includes("certificate of eligibility") || t.includes("coe")) return "How do I get my COE quickly, and what documents do I need?";
    if (t.includes("escape clause")) return "When should I use the VA Escape Clause, and what does it protect me from?";
    if (t.includes("appraisal")) return "What can cause a VA appraisal to come in low or fail, and what are my options?";
    if (t.includes("closing costs")) return "Which closing costs can the seller pay, and what can I finance or roll in?";
    if (t.includes("assumption")) return "Can someone assume my VA loan, and what happens to my entitlement?";
    if (t.includes("irr")) return "When does an IRRRL make sense, and what are the tradeoffs?";
    return `Explain "${sec.title}" in simple terms and tell me what to watch out for.`;
  }
  // ============================================================
  // //#12 RENDER: BUCKET VIEW (MAIN PANEL)
  // ============================================================
  function sectionCardHTML(sec, bucketLabel) {
    const done = isDone(sec.key);
    const pageLabel = `Pages ${sec.start_page}–${sec.end_page}`;
    const openPdf = PDF_URL ? pdfLink(sec.start_page) : "";
    const plain = sec.__plain || [];
    const official = sec.__official || "";
    return `
      <div class="va-card" data-sec="${esc(sec.key)}" style="grid-column:1/-1;">
        <h4>
          <span>${esc(sec.title)}</span>
          <span style="color:rgba(234,240,255,.60); font-weight:900; letter-spacing:.10em; text-transform:uppercase; font-size:11px;">
            ${esc(bucketLabel)} • ${esc(pageLabel)}
          </span>
        </h4>
        <div style="display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:10px;">
          <label style="display:flex; gap:10px; align-items:center; cursor:pointer; color:rgba(234,240,255,.85); font-size:12px;">
            <input type="checkbox" class="va-done" ${done ? "checked" : ""} style="accent-color: #8ef3c5;">
            Mark complete
          </label>
          <button type="button" class="va-btn primary va-ask" style="margin-left:auto;">
            Ask PCS
          </button>
          ${openPdf ? `<a class="va-btn" href="${esc(openPdf)}" target="_blank" rel="noopener">Open PDF here</a>` : ``}
        </div>
        <div class="va-grid" style="grid-template-columns: 1.05fr .95fr; gap:12px;">
          <div style="border-radius:16px; border:1px solid rgba(255,255,255,.10); background: rgba(10,18,32,.35); padding:12px;">
            <div style="font-size:12px; font-weight:900; letter-spacing:.14em; text-transform:uppercase; color:rgba(234,240,255,.85);">
              In plain English
            </div>
            <ul class="va-list" style="margin-top:8px;">
              ${plain.map(li => `<li>${esc(li)}</li>`).join("")}
            </ul>
            <div class="va-subnote">
              This is a simplified “quick take.” Use the official text when you need exact wording.
            </div>
          </div>
          <div style="border-radius:16px; border:1px solid rgba(255,255,255,.10); background: rgba(10,18,32,.35); padding:12px;">
            <div style="font-size:12px; font-weight:900; letter-spacing:.14em; text-transform:uppercase; color:rgba(234,240,255,.85);">
              Official guide text
            </div>
            <details class="va-details" style="margin-top:10px;">
              <summary style="cursor:pointer; font-weight:900; letter-spacing:.12em; text-transform:uppercase; color:rgba(234,240,255,.90); font-size:12px;">
                Show official text
              </summary>
              <div style="
                margin-top:10px;
                white-space:pre-wrap;
                font-size:13px;
                line-height:1.55;
                color:rgba(234,240,255,.92);
                background:rgba(0,0,0,.18);
                border:1px solid rgba(255,255,255,.10);
                border-radius:14px;
                padding:12px;
                max-height:320px;
                overflow:auto;
              ">${esc(official || "No text available for this section.")}</div>
            </details>
            <div class="va-subnote">
              Source of truth: VA Buyer’s Guide. (No re-writing here.)
            </div>
          </div>
        </div>
      </div>
    `;
  }
  function bucketHeroHTML(bucket) {
    const all = bucket.items.length;
    const done = bucket.items.reduce((acc, it) => acc + (isDone(it.key) ? 1 : 0), 0);
    return `
      <div class="va-hero">
        <h3>${esc(bucket.label)}</h3>
        <p>${esc(bucket.hint)} • Progress in this topic: <b style="color:rgba(234,240,255,.95);">${done}/${all}</b></p>
        <div class="va-row">
          <button class="va-btn primary" type="button" id="va-next-in-bucket">Next sub-topic</button>
          <button class="va-btn" type="button" id="va-reset-all">Reset all progress</button>
          <button class="va-btn" type="button" id="va-jump-search">Search the guide</button>
        </div>
      </div>
    `;
  }
  function renderBucketView() {
    const bucket = BUCKETS.find(b => b.id === ACTIVE_BUCKET_ID) || BUCKETS[0];
    if (!bucket) return;
    const cards = bucket.items.map(sec => sectionCardHTML(sec, bucket.label)).join("");
    contentEl.innerHTML = `
      ${bucketHeroHTML(bucket)}
      <div class="va-grid" style="grid-template-columns: 1fr; gap:12px; margin-top:12px;">
        ${cards}
      </div>
    `;
    // Wire: Done checkboxes
    contentEl.querySelectorAll(".va-card").forEach(card => {
      const key = card.getAttribute("data-sec");
      const doneBox = $qs(".va-done", card);
      const askBtn = $qs(".va-ask", card);
      if (doneBox && key) {
        doneBox.addEventListener("change", (e) => {
          setDone(key, !!e.target.checked);
          // also refresh nav stats
          renderNav();
        });
      }
      if (askBtn && key) {
        const sec = SECTIONS.find(s => s.key === key);
        askBtn.addEventListener("click", () => {
          const q = sec ? suggestedQuestionForSection(sec) : "Explain this section in simple terms.";
          prefillAskPCS(q);
        });
      }
    });
    // Wire: Reset all
    const resetAll = document.getElementById("va-reset-all");
    if (resetAll) {
      resetAll.addEventListener("click", () => {
        progress = safeProgress(progress);
        progress.done = {};
        saveProgress();
        renderAll();
      });
    }
    // Wire: Search jump
    const jumpSearch = document.getElementById("va-jump-search");
    if (jumpSearch) {
      jumpSearch.addEventListener("click", () => {
        ACTIVE_VIEW = "search";
        renderAll();
        if (searchEl) { searchEl.focus(); }
      });
    }
    // Wire: Next sub-topic (first incomplete in this bucket)
    const nextBtn = document.getElementById("va-next-in-bucket");
    if (nextBtn) {
      nextBtn.addEventListener("click", () => {
        const next = bucket.items.find(it => !isDone(it.key)) || bucket.items[0];
        if (!next) return;
        const card = contentEl.querySelector(`.va-card[data-sec="${CSS.escape(next.key)}"]`);
        if (card) {
          try { card.scrollIntoView({ behavior: "smooth", block: "start" }); } catch {}
          // pulse highlight
          card.style.outline = "2px solid rgba(142,243,197,.35)";
          setTimeout(() => { card.style.outline = ""; }, 900);
        }
      });
    }
  }
  // ============================================================
  // //#13 SEARCH VIEW (SPOTLIGHT-ISH)
  // - Search across ALL sections (title + official text)
  // ============================================================
  function renderSearchView(q = "") {
    const query = String(q || "").trim();
    const qLower = query.toLowerCase();
    let hits = [];
    if (query.length >= 2) {
      for (const sec of SECTIONS) {
        const t = sec.title.toLowerCase();
        const body = (sec.__official || "").toLowerCase();
        if (t.includes(qLower) || body.includes(qLower)) {
          const sn = snippet(sec.__official || "", query);
          hits.push({
            key: sec.key,
            title: sec.title,
            pages: `Pages ${sec.start_page}–${sec.end_page}`,
            snippet: sn || "Match found in this section.",
            bucketId: findBucketIdForSection(sec.key)
          });
        }
      }
      hits = hits.slice(0, MAX_SEARCH_RESULTS);
    }
    const hero = `
      <div class="va-hero">
        <h3>Search the VA Guide</h3>
        <p>Type a keyword (funding fee, entitlement, COE, escape clause). Results route you into the right topic.</p>
        <div class="va-row">
          <button class="va-btn" type="button" id="va-back-to-bucket">Back to Topics</button>
          <button class="va-btn primary" type="button" id="va-deep-prompt">Ask PCS about: “${esc(query || "…")}”</button>
        </div>
      </div>
    `;
    const resultsHTML = (query.length < 2)
      ? `<div class="va-card" style="grid-column:1/-1;">
           <h4>Start typing</h4>
           <div class="va-subnote">Tip: try <b>funding fee</b>, <b>COE</b>, <b>escape clause</b>, <b>closing costs</b>, <b>appraisal</b>.</div>
         </div>`
      : (hits.length
        ? hits.map(h => `
            <div class="va-card" data-hit="${esc(h.key)}" style="grid-column:1/-1;">
              <h4>
                <span>${esc(h.title)}</span>
                <span style="color:rgba(234,240,255,.60); font-weight:900; letter-spacing:.10em; text-transform:uppercase; font-size:11px;">
                  ${esc(h.pages)}
                </span>
              </h4>
              <div style="color:rgba(234,240,255,.80); font-size:13px; line-height:1.55;">
                ${esc(h.snippet)}…
              </div>
              <div class="va-row" style="margin-top:10px;">
                <button class="va-btn primary va-open-hit" type="button">Open in Topic</button>
                <button class="va-btn va-ask-hit" type="button">Ask PCS</button>
              </div>
            </div>
          `).join("")
        : `<div class="va-card" style="grid-column:1/-1;">
             <h4>No matches</h4>
             <div class="va-subnote">Try shorter keywords or different wording.</div>
           </div>`
      );
    contentEl.innerHTML = `
      ${hero}
      <div class="va-grid" style="grid-template-columns: 1fr; gap:12px; margin-top:12px;">
        ${resultsHTML}
      </div>
    `;
    // Back
    const back = document.getElementById("va-back-to-bucket");
    if (back) {
      back.addEventListener("click", () => {
        ACTIVE_VIEW = "bucket";
        renderAll();
      });
    }
    // Ask PCS
    const deep = document.getElementById("va-deep-prompt");
    if (deep) {
      deep.addEventListener("click", () => {
        const q2 = query ? `VA Guide question: ${query}` : "Explain VA loans in simple terms for a first-time buyer.";
        prefillAskPCS(q2);
      });
    }
    // Open hit
    contentEl.querySelectorAll(".va-card[data-hit]").forEach(card => {
      const key = card.getAttribute("data-hit");
      const openBtn = $qs(".va-open-hit", card);
      const askBtn = $qs(".va-ask-hit", card);
      const sec = SECTIONS.find(s => s.key === key);
      if (openBtn && sec) {
        openBtn.addEventListener("click", () => {
          const bucketId = findBucketIdForSection(sec.key);
          ACTIVE_BUCKET_ID = bucketId || ACTIVE_BUCKET_ID;
          ACTIVE_VIEW = "bucket";
          renderAll();
          // scroll to the exact sub-card
          setTimeout(() => {
            const target = contentEl.querySelector(`.va-card[data-sec="${CSS.escape(sec.key)}"]`);
            if (target) {
              try { target.scrollIntoView({ behavior: "smooth", block: "start" }); } catch {}
              target.style.outline = "2px solid rgba(106,167,255,.35)";
              setTimeout(() => { target.style.outline = ""; }, 1000);
              // auto-open details
              const det = $qs("details.va-details", target);
              if (det) det.open = true;
            }
          }, 50);
        });
      }
      if (askBtn && sec) {
        askBtn.addEventListener("click", () => {
          prefillAskPCS(suggestedQuestionForSection(sec));
        });
      }
    });
  }
  function findBucketIdForSection(sectionKey) {
    for (const b of BUCKETS) {
      if (b.items.some(it => it.key === sectionKey)) return b.id;
    }
    return null;
  }
  // ============================================================
  // //#14 SEARCH INPUT WIRING
  // - If user types: switch to Search view
  // - If cleared: return to bucket view
  // ============================================================
  const onSearch = debounce(() => {
    const q = String(searchEl?.value || "").trim();
    if (!q) {
      ACTIVE_VIEW = "bucket";
      renderAll();
      return;
    }
    ACTIVE_VIEW = "search";
    renderAll();
  }, 160);
  if (searchEl) {
    searchEl.addEventListener("input", onSearch);
  }
  // ============================================================
  // //#15 RENDER ALL
  // ============================================================
  function renderAll() {
    renderNav();
    paintProgress();
    const q = String(searchEl?.value || "").trim();
    if (ACTIVE_VIEW === "search") renderSearchView(q);
    else renderBucketView();
  }
  // ============================================================
  // //#16 BOOT
  // ============================================================
  async function boot() {
    // Minimal loading state
    contentEl.innerHTML = `
      <div class="va-hero">
        <h3>Loading VA Guide…</h3>
        <p>Connecting to PCSUnited guide service and building your 6-topic layout.</p>
      </div>
    `;
    API_BASE = await resolveAPIBase();
    if (!API_BASE) {
      contentEl.innerHTML = `
        <div class="va-hero">
          <h3>Guide could not load</h3>
          <p style="color:rgba(234,240,255,.75);">
            I couldn’t reach your JSON endpoint. Fix by ensuring you have a Netlify function at:
            <b>/api/va-guide</b> (and <b>?lite=1</b> works too).
          </p>
          <div class="va-row" style="margin-top:10px;">
            <button class="va-btn primary" type="button" id="va-retry">Retry</button>
            <button class="va-btn" type="button" id="va-debug">Show debug tips</button>
          </div>
          <div id="va-debug-box" style="display:none; margin-top:12px; color:rgba(234,240,255,.70); font-size:13px; line-height:1.55;">
            <b>Expected:</b> https://YOUR_NETLIFY_SITE.netlify.app/api/va-guide<br/>
            <b>Also:</b> https://YOUR_NETLIFY_SITE.netlify.app/api/va-guide?lite=1<br/><br/>
            If you used the function I provided earlier, confirm:
            <ul style="margin:8px 0 0; padding-left:18px;">
              <li>JSON files are in <b>netlify/functions/data/</b></li>
              <li>netlify.toml has <b>[functions].included_files</b> including that folder</li>
              <li>Function file name matches <b>va-guide.js</b></li>
            </ul>
          </div>
        </div>
      `;
      const retry = document.getElementById("va-retry");
      const debug = document.getElementById("va-debug");
      const box = document.getElementById("va-debug-box");
      if (retry) retry.addEventListener("click", () => boot());
      if (debug && box) debug.addEventListener("click", () => box.style.display = (box.style.display === "none" ? "block" : "none"));
      return;
    }
    // Fetch full guide
    const full = await tryFetchJSON(`${API_BASE}/va-guide`);
    if (!full || !full.ok) throw new Error("va-guide did not return ok:true");
    GUIDE = full;
    // Normalize sections + compute text/summary (lightweight)
    SECTIONS = normalizeSections(GUIDE).map(sec => {
      const official = getSectionText(sec);
      return {
        ...sec,
        __official: official,
        __plain: buildPlainEnglish(official)
      };
    });
    // 6 buckets only
    BUCKETS = buildBuckets(SECTIONS);
    // Set active bucket safely
    if (!BUCKETS.some(b => b.id === ACTIVE_BUCKET_ID)) {
      ACTIVE_BUCKET_ID = BUCKETS[0]?.id || "eligibility-coe";
    }
    // Initial paint
    renderAll();
  }
  boot().catch((err) => {
    console.error(err);
    contentEl.innerHTML = `
      <div class="va-hero">
        <h3>Guide failed to initialize</h3>
        <p style="color:rgba(234,240,255,.75);">
          Error: <b>${esc(err?.message || err)}</b>
        </p>
        <div class="va-row" style="margin-top:10px;">
          <button class="va-btn primary" type="button" id="va-retry2">Retry</button>
        </div>
      </div>
    `;
    const r = document.getElementById("va-retry2");
    if (r) r.addEventListener("click", () => boot());
  });
})();
</script>
  </div><img src="images/91DD9F7D-635E-4DF0-BE05-1D98376A2EF1.png" loading="lazy" sizes="(max-width: 1536px) 100vw, 1536px" srcset="images/91DD9F7D-635E-4DF0-BE05-1D98376A2EF1-p-500.png 500w, images/91DD9F7D-635E-4DF0-BE05-1D98376A2EF1-p-800.png 800w, images/91DD9F7D-635E-4DF0-BE05-1D98376A2EF1-p-1080.png 1080w, images/91DD9F7D-635E-4DF0-BE05-1D98376A2EF1.png 1536w" alt="" class="image">
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=69658389f59da527c04bcbd4" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
</body>
</html>