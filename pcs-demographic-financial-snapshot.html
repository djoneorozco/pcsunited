<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Sun Jan 18 2026 11:30:14 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="696731f983d4f50d006664d1" data-wf-site="69658389f59da527c04bcbd4" lang="en">
<head>
  <meta charset="utf-8">
  <title>PCS Snapshot</title>
  <meta content="We provide VA-Loan, Realty, and Financial education and training videos for the military community. A.I Integrated support provided insight on your current and future base pay and BAH to make smarter decision." name="description">
  <meta content="PCS Snapshot" property="og:title">
  <meta content="We provide VA-Loan, Realty, and Financial education and training videos for the military community. A.I Integrated support provided insight on your current and future base pay and BAH to make smarter decision." property="og:description">
  <meta content="https://cdn.prod.website-files.com/69658389f59da527c04bcbd4/6966c986c8472ee377c2b9df_ffdcab38d6a982d23413fb95c1452762_PCSUnited.jpg" property="og:image">
  <meta content="PCS Snapshot" property="twitter:title">
  <meta content="We provide VA-Loan, Realty, and Financial education and training videos for the military community. A.I Integrated support provided insight on your current and future base pay and BAH to make smarter decision." property="twitter:description">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/pcs-united.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <div class="w-embed w-script"><!--  =========================================================
  PCS SNAPSHOT v3.2.2 • House of SaSS (PCS UNITED)
  ✅ Theme Update: Match AIOU “House of SaSS” (tokens, cards, buttons, typography)
  ✅ Keeps your IDs + structure + logic intact
  ✅ Charts still fit 1 screen (your sizing stays)
=========================================================  -->
    <div id="pcs-snapshot-shell" style="all: initial;">
      <!--  FONTS + CHART LIBRARIES  -->
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
      <style>
    /* =========================================================
       //#0 – FULL SCREEN OVERRIDE (KEPT)
    ========================================================= */
    #pcs-snapshot-shell{
      position: fixed !important;
      inset: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      overflow: auto !important;
      background: #0b0e1a !important;
      z-index: 2147483646 !important;
      display: block !important;
      margin: 0 !important;
      padding: 0 !important;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      isolation: isolate;
    }
    #pcs-snapshot-shell{
      padding-top: env(safe-area-inset-top);
      padding-right: env(safe-area-inset-right);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
    }
    /* =========================================================
       //#1 GLOBAL TOKENS / RESET (AIOU THEME)
    ========================================================= */
    #pcs-snapshot-shell,
    #pcs-snapshot-shell * {
      box-sizing: border-box;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    :root{
      --bg:#0b0e1a;
      --panel:#101426;
      --panel-2:#0f1324;
      --ink:#e9ecff;
      --muted:#a8b0d6;
      --border:rgba(255,255,255,.10);
      --accent:#8ef3c5;
      --accent2:#6aa7ff;
      --danger:#ff8aa6;
      /* AIOU chip gradient */
      --chip-bg-start:#6aa7ff;
      --chip-bg-end:#4f86ff;
      /* extra */
      --shadow: 0 24px 48px rgba(0,0,0,.8);
      --shadow-inset: 0 16px 32px rgba(0,0,0,.6) inset;
      --radius: 18px;
    }
    h2,h3,h4 { margin: 0; padding: 0; }
    /* =========================================================
       //#2 WRAP (AIOU-LIKE SPACING)
    ========================================================= */
    #pcs-snapshot-wrap{
      width: 100%;
      max-width: 1400px;
      min-width: 1024px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 22px 24px 28px;
      background: var(--bg);
      color: var(--ink);
    }
    @media(max-width:1100px){
      #pcs-snapshot-wrap{
        min-width: 0;
        max-width: 100%;
        padding: 18px 14px 22px;
      }
    }
    /* =========================================================
       //#3 HEADER (AIOU LOOK)
    ========================================================= */
    .pcs-header-center{
      background:
        radial-gradient(circle at 0% 0%, rgba(255,255,255,.07) 0%, rgba(0,0,0,0) 60%),
        linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.015) 60%,rgba(0,0,0,0) 100%);
      background-color: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px 14px;
      margin-bottom: 14px;
    }
    .pcs-header-center h2{
      font-size: 22px;
      font-weight: 900;
      line-height: 1.25;
      letter-spacing: .2px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .pcs-tagline{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
      line-height: 1.4;
    }
    .pcs-income-main{
      font-size: 18px;
      font-weight: 900;
      color: var(--ink);
      margin: 10px 0 2px;
      letter-spacing: .2px;
    }
    .pcs-income-breakdown{
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 14px;
      line-height: 1.4;
    }
    /* =========================================================
       //#4 CARD STYLE (AIOU-CARD EQUIVALENT)
    ========================================================= */
    .pcs-panel{
      background:
        radial-gradient(circle at 0% 0%, rgba(255,255,255,.07) 0%, rgba(0,0,0,0) 60%),
        linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.015) 60%,rgba(0,0,0,0) 100%);
      background-color: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 14px 14px;
      box-shadow: var(--shadow);
      position: relative;
      color: var(--ink);
    }
    .pcs-panel h4{
      font-size: 14px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .2px;
      margin-bottom: 6px;
    }
    .pcs-small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.4;
    }
    .pcs-highlight-teal{ color: var(--accent); font-weight: 800; }
    .pcs-highlight-blue{ color: var(--accent2); font-weight: 800; }
    /* =========================================================
       //#5 GRID (KEPT STRUCTURE, AIOU SPACING)
    ========================================================= */
    .pcs-grid-2{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 14px;
    }
    @media (max-width: 900px) {
      .pcs-grid-2 { grid-template-columns: 1fr; }
    }
    /* =========================================================
       //#6 CHART SIZING (KEPT)
    ========================================================= */
    .pcs-canvas{
      width: 100% !important;
      max-height: 170px !important;
      display: block;
    }
    .pcs-canvas-tall{
      width: 100% !important;
      max-height: 190px !important;
      display: block;
    }
    @media (max-width: 900px) {
      .pcs-canvas, .pcs-canvas-tall { max-height: 220px !important; }
    }
    /* =========================================================
       //#7 TREND TOGGLES (AIOU BUTTON STYLE)
    ========================================================= */
    .trend-toggle{
      display: flex;
      gap: 10px;
      margin-top: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .trend-btn{
      border: 1px solid rgba(255,255,255,.14);
      background: var(--panel-2);
      color: var(--ink);
      padding: 9px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 900;
      font-size: 12px;
      line-height: 1.2;
      letter-spacing: .02em;
      box-shadow: 0 12px 26px rgba(0,0,0,.65);
    }
    .trend-btn.active{
      background: linear-gradient(180deg,var(--chip-bg-start),var(--chip-bg-end));
      border: none;
      color: #06112b;
      box-shadow: 0 16px 32px rgba(0,0,0,.8);
    }
    #pcs-trend-chart-apex{
      width: 100%;
      height: 200px;
      margin-top: 6px;
      border-radius: 12px;
      overflow: hidden;
    }
    @media (max-width: 900px){
      #pcs-trend-chart-apex { height: 220px; }
    }
    /* =========================================================
       //#8 QUICKFACTS (AIOU CARD MINI)
    ========================================================= */
    h3.pcs-qf-title{
      margin-top: 16px;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .2px;
      color: var(--ink);
    }
    .pcs-quickfacts{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media (max-width: 900px){
      .pcs-quickfacts{ grid-template-columns: 1fr; }
    }
    .pcs-fact{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: var(--shadow);
    }
    .pcs-fact-label{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .1em;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 800;
    }
    .pcs-fact-value{
      font-size: 14px;
      font-weight: 900;
      color: var(--ink);
      line-height: 1.2;
    }
    /* subtle divider style to match AIOU */
    .pcs-divider{
      border: 0;
      border-top: 1px solid rgba(255,255,255,.08);
      margin: 12px 0;
    }
    /* keep text selection safe */
    #pcs-snapshot-wrap ::selection{
      background: rgba(142,243,197,.22);
    }
  </style>
      <div id="pcs-snapshot-wrap">
        <!--  HEADER  -->
        <div class="pcs-header-center">
          <h2>Permanent Change of Duty Station PCS Snapshot</h2>
          <div class="pcs-tagline" id="pcs-city-line">Loading city data…</div>
          <div id="pcs-income-main" class="pcs-income-main">$0 / month</div>
          <div id="pcs-income-breakdown" class="pcs-income-breakdown">
            Base Pay: — • BAH: — • BAS: —
          </div>
        </div>
        <!--  =================== TOP GRID ===================  -->
        <div class="pcs-grid-2">
          <!--  LEFT: Income  -->
          <div class="pcs-panel">
            <h4>Your Income vs City Average</h4>
            <div class="pcs-small">Annual comparison (Low / Avg / High / You)</div>
            <canvas id="pcs-income-chart" class="pcs-canvas" height="160"></canvas>
            <div id="pcs-income-summary" class="pcs-small pcs-highlight-teal"></div>
          </div>
          <!--  RIGHT: Mortgage  -->
          <div class="pcs-panel">
            <h4>Your BAH vs Average Mortgage</h4>
            <div class="pcs-small">Monthly comparison (Low / Avg / High / Your BAH)</div>
            <canvas id="pcs-bah-chart" class="pcs-canvas" height="160"></canvas>
            <div id="pcs-bah-summary" class="pcs-small pcs-highlight-blue"></div>
            <div class="pcs-small" style="margin-top:4px;color:#7a86a8;">
              Mortgage estimate based on 6.75% interest rate.
            </div>
          </div>
        </div>
        <!--  =================== BOTTOM GRID ===================  -->
        <div class="pcs-grid-2" style="margin-top:14px;">
          <!--  LEFT: APEXCHART TREND + PRICE BREAKDOWN  -->
          <div class="pcs-panel">
            <h4>12-Month Housing Trend</h4>
            <div class="pcs-small">Median home price (interactive trend)</div>
            <div class="trend-toggle">
              <button class="trend-btn active" id="btn-1yr" type="button">1 Year</button>
              <button class="trend-btn" id="btn-3yr" type="button">3 Years</button>
            </div>
            <div id="pcs-trend-chart-apex"></div>
            <div id="pcs-trend-summary" class="pcs-small pcs-highlight-teal"></div>
            <hr class="pcs-divider">
            <h4>Market Price Breakdown</h4>
            <div class="pcs-small">Median Sale • Avg Sale • Median Listing</div>
            <canvas id="pcs-pricebreak-chart" class="pcs-canvas" height="150"></canvas>
            <div id="pcs-pricebreak-note" class="pcs-small" style="margin-top:6px;color:#7a86a8;"></div>
          </div>
          <!--  RIGHT: Affordability  -->
          <div class="pcs-panel">
            <h4>Affordability Index</h4>
            <div class="pcs-small">Higher score = better fit for your income</div>
            <canvas id="pcs-afford-chart" class="pcs-canvas-tall" height="190"></canvas>
            <div id="pcs-afford-summary" class="pcs-small"></div>
          </div>
        </div>
        <!--  QUICKFACTS  -->
        <h3 class="pcs-qf-title">City QuickFacts</h3>
        <div id="pcs-quickfacts" class="pcs-quickfacts"></div>
      </div>
      <!--  =========================================================
       JAVASCRIPT (UNCHANGED LOGIC)
  =========================================================  -->
      <script>
(function () {
  "use strict";
  // ============================================================
  // //#0 CONFIG
  // ============================================================
  const API_BASE = "https://theorozcorealty.netlify.app/api";
  const MILPAY_JSON_URL =
    "https://raw.githubusercontent.com/djoneorozco/OrozcoRealty/main/netlify/functions/data/militaryPayTables.json";
  // Backup (only used if Netlify /api/city returns 404)
  const CITY_GITHUB_RAW_BASE =
    "https://raw.githubusercontent.com/djoneorozco/OrozcoRealty/main/netlify/functions/cities/";
  // ============================================================
  // //#1 HELPERS
  // ============================================================
  function getQuery() {
    const u = new URL(window.location.href);
    return {
      type: (u.searchParams.get("type") || "ad").toLowerCase(),
      rank: u.searchParams.get("rank") || "E4",
      yos: parseInt(u.searchParams.get("yos") || "2", 10),
      family: parseInt(u.searchParams.get("family") || "1", 10),
      base: u.searchParams.get("base") || "Lackland",
      va: parseInt(u.searchParams.get("va") || "0", 10),
      cityKey: u.searchParams.get("cityKey") || ""   // can be base-key now
    };
  }
  // FIX: handle E4, E-4, O3, O-3 safely (prevents E--4)
  function normRank(r) {
    const s = String(r || "").toUpperCase().trim();
    const m = s.match(/^([EO])\s*-\s*(\d+)$/) || s.match(/^([EO])(\d+)$/) || s.match(/^(E)\s*-\s*(\d+)$/) || s.match(/^(E)(\d+)$/);
    if (m) return m[1] + "-" + m[2];
    return s.replace(/\s+/g,"");
  }
  function isE(rankKey) { return String(rankKey || "").startsWith("E-"); }
  function pickYOS(y, table) {
    const ks = Object.keys(table || {}).map(k => parseInt(k,10)).filter(n=>!isNaN(n)).sort((a,b)=>a-b);
    if (!ks.length) return String(y);
    let best = ks[0], diff = Math.abs(y - best);
    ks.forEach(k => {
      const d = Math.abs(y-k);
      if (d < diff){ diff = d; best = k; }
    });
    return String(best);
  }
  function money(n){
    const x = Number(n);
    if (!Number.isFinite(x)) return "$0";
    return "$" + Math.round(x).toLocaleString();
  }
  function safe(obj, path, fb) {
    try { return path.split(".").reduce((a,k)=>a && a[k], obj) ?? fb; }
    catch { return fb; }
  }
  async function load(url){
    const r = await fetch(url, { cache: "no-store" });
    if(!r.ok) throw new Error("load fail "+url+" ("+r.status+")");
    return await r.json();
  }
  function normalizeCityKey(key, baseFallback){
    const raw = String(key || "").trim();
    const base = String(baseFallback || "").trim();
    // Prefer explicit cityKey; else use base
    const primary = (raw ? raw : base) || "Lackland";
    // Try a few likely filename formats (because your folder uses hyphens in some names)
    const variants = [];
    const push = (v)=>{ if (v && !variants.includes(v)) variants.push(v); };
    push(primary);
    push(primary.replace(/\s+/g,"-"));      // "Fort Sam Houston" -> "Fort-Sam-Houston"
    push(primary.replace(/\s+/g,""));       // "FortSamHouston"
    push(primary.replace(/-/g,""));         // "FortSamHouston"
    push(primary.replace(/[^A-Za-z0-9-]/g,""));
    // Compatibility: if someone passes "SanAntonio" or "San Antonio" treat it as Lackland
    if (/^SAN\s*ANTONIO$/i.test(primary) || /^SANANTONIO$/i.test(primary)){
      push("Lackland");
    }
    return variants;
  }
  async function loadCity(cityKey, baseLoc){
    const keysToTry = normalizeCityKey(cityKey, baseLoc);
    // 1) Try Netlify /api/city first
    for (const k of keysToTry){
      const url = `${API_BASE}/city?cityKey=${encodeURIComponent(k)}`;
      try{
        return await load(url);
      } catch(e){
        // continue
      }
    }
    // 2) Fallback to GitHub raw (ONLY if Netlify fails)
    for (const k of keysToTry){
      const url = `${CITY_GITHUB_RAW_BASE}${encodeURIComponent(k)}.json`;
      try{
        return await load(url);
      } catch(e){
        // continue
      }
    }
    throw new Error("City load failed for: " + keysToTry.join(", "));
  }
  function normalizeTrendDate(dt){
    const s = String(dt || "").trim();
    if (!s) return null;
    // Handles "2025-12-W1" style: convert to a reasonable day in month
    const m = s.match(/^(\d{4})-(\d{2})-W(\d{1,2})$/);
    if (m){
      const y = Number(m[1]), mo = Number(m[2]), w = Number(m[3]);
      const day = Math.min(28, 1 + (w-1)*7);
      const iso = `${y}-${String(mo).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
      const d = new Date(iso);
      return isNaN(d.getTime()) ? null : d;
    }
    const d = new Date(s);
    return isNaN(d.getTime()) ? null : d;
  }
  /* ======================================================
       APEXCHARTS TREND RENDERER
  ====================================================== */
  function renderTrendApex(fullData) {
    const chartEl = document.querySelector("#pcs-trend-chart-apex");
    if (!chartEl) return;
    if (window.pcsTrendChart) {
      try { window.pcsTrendChart.destroy(); } catch {}
    }
    const seriesData = (Array.isArray(fullData) ? fullData : []).map(d => {
      const dt = d.month || d.date || d.period || d.timestamp || null;
      const price = d.median_sale_price ?? d.medianSalePrice ?? d.median ?? d.value ?? null;
      const x = normalizeTrendDate(dt);
      const y = Number(price);
      return (x && Number.isFinite(y)) ? { x, y } : null;
    }).filter(Boolean);
    const options = {
      chart: {
        type: 'line',
        height: 200,
        foreColor: '#e9ecff',
        toolbar: { show: false }
      },
      stroke: {
        width: 3,
        curve: 'smooth',
        colors: ['#8ef3c5']
      },
      series: [{
        name: "Median Sale Price",
        data: seriesData
      }],
      xaxis: { type: 'datetime', labels: { style: { colors: '#e9ecff' } } },
      yaxis: {
        labels: {
          style: { colors: '#e9ecff' },
          formatter: val => "$" + Math.round(val).toLocaleString()
        }
      },
      tooltip: {
        theme: 'dark',
        x: { format: "MMM yyyy" },
        y: { formatter: v => "$" + Math.round(v).toLocaleString() }
      },
      grid: { borderColor: "rgba(255,255,255,0.08)" }
    };
    window.pcsTrendChart = new ApexCharts(chartEl, options);
    window.pcsTrendChart.render();
  }
  /* ======================================================
       MAIN INIT
  ====================================================== */
  async function init(){
    const p = getQuery();
    const rankKey = normRank(p.rank);
    const isAD = p.type === "ad";
    const [city, pay] = await Promise.all([
      loadCity(p.cityKey, p.base),
      load(MILPAY_JSON_URL)
    ]);
    /* ------------------------------------
       PAY CALCULATION — UPDATED BAH LOOKUP (FIX)
       - Uses pay.BAH.base_to_zip + pay.BAH.by_zip first
       - Falls back to pay.BAH_TX if needed
    ------------------------------------ */
    let base=0, bah=0, bas=0;
    if (isAD) {
      const table = (pay.BASEPAY && pay.BASEPAY[rankKey]) ? pay.BASEPAY[rankKey] : {};
      const yKey = pickYOS(p.yos, table);
      base = table[yKey] || 0;
      bas = isE(rankKey)
        ? safe(pay,"BAS.enlisted",0)
        : safe(pay,"BAS.officer",0);
      // ZIP from base name
      const baseToZip = safe(pay, "BAH.base_to_zip", {}) || {};
      const zip = baseToZip[p.base] || baseToZip[(p.base + " AFB")] || baseToZip[(p.base + " Air Force Base")] || baseToZip["Lackland"] || "78236";
      // Prefer pay.BAH.by_zip
      const byZip = safe(pay, "BAH.by_zip", {}) || {};
      const rec1 = byZip[String(zip)] || null;
      // Fallback: pay.BAH_TX if present
      const bahTX = pay.BAH_TX || {};
      const rec2 = bahTX[String(zip)] || null;
      const rec = rec1 || rec2;
      const grp = (p.family > 1) ? safe(rec, "with", null) : safe(rec, "without", null);
      if (grp && grp[rankKey] != null) bah = Number(grp[rankKey]) || 0;
    } else {
      const full = pay.DISABILITY_FULL || {};
      const keys = Object.keys(full).map(k=>parseInt(k,10)).filter(n=>!isNaN(n)).sort((a,b)=>a-b);
      let best = keys[0] ?? 0, diff=Math.abs(p.va-best);
      keys.forEach(k=>{
        const d = Math.abs(p.va-k);
        if(d < diff){ diff=d; best=k; }
      });
      const row = full[String(best)];
      base = row ? row.veteran : 0;
      bah = 0; bas = 0;
    }
    const total = base + bah + bas;
    document.getElementById("pcs-city-line").textContent =
      (city.place || city.city || city.name || "Selected Location") + " • Quick PCS Snapshot";
    document.getElementById("pcs-income-main").textContent =
      money(total) + " / month";
    document.getElementById("pcs-income-breakdown").textContent =
      "Base Pay: " + money(base) + " • BAH: " + money(bah) + " • BAS: " + money(bas);
    /* ------------------------------------
       INCOME VS CITY (UPDATED to match your new schema)
    ------------------------------------ */
    const medInc =
      safe(city,"income.median_household_income", null) ??
      safe(city,"demographics.income.median_household_income", null) ??
      safe(city,"median_household_income", 60000);
    const low = medInc*0.6;
    const avg = medInc;
    const high = medInc*1.35;
    const userA = total*12;
    new Chart(document.getElementById("pcs-income-chart"),{
      type:"bar",
      data:{
        labels:["Low","Avg","High","You"],
        datasets:[{
          data:[low,avg,high,userA],
          backgroundColor:["#1a2239","#4f86ff","#6aa7ff","#8ef3c5"]
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{legend:{display:false}},
        scales:{
          y:{ticks:{color:"#e9ecff", callback:v=>"$"+(v/1000)+"k"},
             grid:{color:"rgba(255,255,255,.06)"}},
          x:{ticks:{color:"#e9ecff"}, grid:{display:false}}
        }
      }
    });
    document.getElementById("pcs-income-summary").textContent =
      ((userA-avg)>=0? "+" : "") +
      (((userA-avg)/Math.max(avg,1))*100).toFixed(1) +
      "% vs median household income";
    /* ------------------------------------
       MORTGAGE USING 6.75% — Resilient to your new JSON fields
    ------------------------------------ */
    const P =
      safe(city,"housing.market.median_listing_price_realtor", null) ??
      safe(city,"housing.market.median_listing_price", null) ??
      safe(city,"housing.market.median_list_price", null) ??
      safe(city,"housing.market.median_listing_price_realtor", null) ??
      safe(city,"avg_home_value", null) ??
      safe(city,"average_home_value", null) ??
      safe(city,"housing.median_value_owner_occupied", 295000);
    const rate = 0.0675/12;
    const N = 360;
    const M = Number(P) * (rate*Math.pow(1+rate,N)) / (Math.pow(1+rate,N)-1);
    const bahLow = M*0.85;
    const bahAvg = M;
    const bahHigh = M*1.15;
    new Chart(document.getElementById("pcs-bah-chart"),{
      type:"bar",
      data:{
        labels:["Low","Avg","High","Your BAH"],
        datasets:[{
          data:[bahLow,bahAvg,bahHigh,bah],
          backgroundColor:["#1a2239","#4f86ff","#6aa7ff","#6aa7ff"]
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{legend:{display:false}},
        scales:{
          y:{ticks:{color:"#e9ecff",callback:v=>"$"+Math.round(v)},
             grid:{color:"rgba(255,255,255,.06)"}},
          x:{ticks:{color:"#e9ecff"},grid:{display:false}}
        }
      }
    });
    document.getElementById("pcs-bah-summary").textContent =
      (bah > 0 && bahAvg > 0)
        ? ("Your BAH covers ~"+((bah/bahAvg)*100).toFixed(1)+"% of estimated mortgage.")
        : ("BAH not found for this rank/base yet — pay tables may be missing that row.");
    /* ======================================================
         TREND (supports 2025-12-W1 format)
    ====================================================== */
    const allMonths =
      safe(city,"housing.market.sale_history_36_months", null) ??
      safe(city,"housing.sale_history_36_months", null) ??
      safe(city,"market.sale_history_36_months", []) ??
      [];
    const last12 = Array.isArray(allMonths) ? allMonths.slice(-12) : [];
    const last36 = Array.isArray(allMonths) ? allMonths.slice(-36) : [];
    renderTrendApex(last12);
    document.getElementById("btn-1yr").onclick = () => {
      document.getElementById("btn-1yr").classList.add("active");
      document.getElementById("btn-3yr").classList.remove("active");
      renderTrendApex(last12);
    };
    document.getElementById("btn-3yr").onclick = () => {
      document.getElementById("btn-3yr").classList.add("active");
      document.getElementById("btn-1yr").classList.remove("active");
      renderTrendApex(last36);
    };
    const yoy =
      safe(city,"housing.market.zillow_one_year_change_percent", null) ??
      safe(city,"housing.market.one_year_change_percent", null) ??
      safe(city,"yoy_change_percent", 0);
    document.getElementById("pcs-trend-summary").textContent =
      "12-month change: "+(Number(yoy)||0)+"% • " +
      (safe(city,"housing.market.market_type_summary","") || "");
    /* ------------------------------------
       PRICE BREAKDOWN — FIXED FOR YOUR NEW JSON
       - Median Sale: uses median_sale_price_current OR q1_2025.median_sale_price
       - Avg Sale: uses average_sale_price if present, otherwise uses median sale as proxy
       - Median List: uses median_listing_price_realtor (present in your Lackland.json)
    ------------------------------------ */
    const medSale =
      safe(city,"housing.market.q1.median_sale_price", null) ??
      safe(city,"housing.market.q1_2025.median_sale_price", null) ??
      safe(city,"housing.market.median_sale_price_current", null) ??
      safe(city,"housing.market.median_sale_price", 0);
    let avgSale =
      safe(city,"housing.market.q1.average_sale_price", null) ??
      safe(city,"housing.market.q1_2025.average_sale_price", null) ??
      safe(city,"housing.market.average_sale_price", null);
    const medList =
      safe(city,"housing.market.median_listing_price_realtor", null) ??
      safe(city,"housing.market.median_listing_price", null) ??
      safe(city,"housing.market.median_list_price", 0);
    let note = "";
    if (avgSale == null || !Number.isFinite(Number(avgSale)) || Number(avgSale) <= 0){
      avgSale = Number(medSale) || 0;
      if (avgSale > 0) note = "Avg Sale not provided in this base JSON — using Median Sale as a placeholder.";
    }
    document.getElementById("pcs-pricebreak-note").textContent = note;
    new Chart(document.getElementById("pcs-pricebreak-chart"),{
      type:"bar",
      data:{
        labels:["Median Sale","Avg Sale","Median List"],
        datasets:[{
          data:[Number(medSale)||0, Number(avgSale)||0, Number(medList)||0],
          backgroundColor:["#8ef3c5","#6aa7ff","#4f86ff"]
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{legend:{display:false}},
        scales:{
          y:{ticks:{color:"#e9ecff",callback:v=>"$"+(v/1000)+"k"},
             grid:{color:"rgba(255,255,255,.06)"}},
          x:{ticks:{color:"#e9ecff"},grid:{display:false}}
        }
      }
    });
    /* ------------------------------------
       AFFORDABILITY — unchanged
    ------------------------------------ */
    const annual = total*12;
    let score = 100 - (Number(P)/Math.max(annual,1))*35;
    score = Math.max(0,Math.min(100,score));
    new Chart(document.getElementById("pcs-afford-chart"),{
      type:"doughnut",
      data:{
        labels:["Score","Remaining"],
        datasets:[{
          data:[score,100-score],
          backgroundColor:["#6aa7ff","#1a2239"],
          borderWidth:0,
          cutout:"70%"
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{legend:{display:false},tooltip:{enabled:false}}
      }
    });
    document.getElementById("pcs-afford-summary").textContent =
      "Affordability Score: "+score.toFixed(0)+"/100.";
    /* ------------------------------------
       QUICKFACTS — updated for your new JSON
    ------------------------------------ */
    const popEst = safe(city,"population.estimate", safe(city,"population",0)) || 0;
    const days =
      safe(city,"housing.market.average_days_on_market", null) ??
      safe(city,"housing.market.average_days_on_market_range.low", null);
    const facts=[
      {label:"Population",value:Number(popEst).toLocaleString()},
      {label:"Median Age",value:safe(city,"population.median_age", safe(city,"median_age", 0))},
      {label:"Median Household Income",value:money(medInc)},
      {label:"Poverty Rate",value:(safe(city,"income.poverty_rate_percent", safe(city,"poverty_rate_percent",0)) || 0) + "%"},
      {label:"Median Home Value",value:money(safe(city,"housing.median_value_owner_occupied", P))},
      {label:"Avg Days on Market",value:(days != null ? String(days) : "—")}
    ];
    let html="";
    facts.forEach(f=>{
      html+=`
        <div class="pcs-fact">
          <div class="pcs-fact-label">${f.label}</div>
          <div class="pcs-fact-value">${f.value}</div>
        </div>`;
    });
    document.getElementById("pcs-quickfacts").innerHTML=html;
  }
  function boot(){
    init().catch(err=>{
      console.error("PCS Snapshot error:",err);
      document.getElementById("pcs-snapshot-wrap").innerHTML =
        "<div style='color:#e9ecff;font-size:14px;padding:24px;'>PCS Snapshot is temporarily unavailable. Try again later.</div>";
    });
  }
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", boot);
  } else {
    boot();
  }
})();
  </script>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=69658389f59da527c04bcbd4" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
</body>
</html>